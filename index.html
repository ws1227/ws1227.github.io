<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="F_pmJOje5pcXixoVap4Vk7vlUPHG5UbaU4Hzn_uhgck" />













  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="ç‹æ£®æŠ€æœ¯åšå®¢" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="ç‹æ£®æŠ€æœ¯åšå®¢ä¸ºä¸ªäººåšå®¢ï¼Œä¸»è¦è®°å½•æŠ€æœ¯æ–‡æ¡£æ¶‰åŠiOSç­‰å¤šä¸ªè¯­è¨€å¹³å°ï¼Œç‹æ£®åšå®¢">
<meta property="og:type" content="website">
<meta property="og:title" content="ç‹æ£®åšå®¢">
<meta property="og:url" content="www.wangsen.website/index.html">
<meta property="og:site_name" content="ç‹æ£®åšå®¢">
<meta property="og:description" content="ç‹æ£®æŠ€æœ¯åšå®¢ä¸ºä¸ªäººåšå®¢ï¼Œä¸»è¦è®°å½•æŠ€æœ¯æ–‡æ¡£æ¶‰åŠiOSç­‰å¤šä¸ªè¯­è¨€å¹³å°ï¼Œç‹æ£®åšå®¢">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ç‹æ£®åšå®¢">
<meta name="twitter:description" content="ç‹æ£®æŠ€æœ¯åšå®¢ä¸ºä¸ªäººåšå®¢ï¼Œä¸»è¦è®°å½•æŠ€æœ¯æ–‡æ¡£æ¶‰åŠiOSç­‰å¤šä¸ªè¯­è¨€å¹³å°ï¼Œç‹æ£®åšå®¢">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="www.wangsen.website/"/>





  <title> ç‹æ£®åšå®¢ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-93848721-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b0e8472d72769ebfb2c0890101ae3f10";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=61230218";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ç‹æ£®åšå®¢</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">æŠ€æœ¯éšç¬”</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="æœç´¢..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="www.wangsen.website/posts/10604/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹æ£®">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹æ£®åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/posts/10604/" itemprop="url">
                  ç³»ç»Ÿæ€§å­¦ä¹ Moya+Alamofire+RxSwift+ObjectMapperçš„é…åˆä½¿ç”¨
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-07-07T19:01:49+08:00">
                2017-07-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/posts/10604/" class="leancloud_visitors" data-flag-title="ç³»ç»Ÿæ€§å­¦ä¹ Moya+Alamofire+RxSwift+ObjectMapperçš„é…åˆä½¿ç”¨">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ç³»ç»Ÿæ€§å­¦ä¹ Moya+Alamofire+RxSwift+ObjectMapperçš„é…åˆä½¿ç”¨</p>
<p>ä¸»è¦æ˜¯ç»ƒä¹ Moyaçš„ç†Ÿç»ƒä½¿ç”¨ï¼Œå…¨æ–‡æ¶‰åŠåˆ°CYLTabBarControlleræ­å»ºç®€å•æ˜“ç”¨çš„æ¡†æ¶ã€Swiftå’ŒOCäº’ç›¸è°ƒç”¨ã€FLEXæ˜¾ç¤ºç•Œé¢å±‚çº§UIçš„å±æ€§ã€ObjectMapperè§£ææ•°æ®ã€KingfisheråŠ è½½ç½‘ç»œå›¾ç‰‡ã€MBProgressHUDèåˆåˆ°è¯·æ±‚é‡Œè‡ªåŠ¨æ˜¾ç¤ºä¸éšè—è¯·æ±‚ç­‰å¾…ã€MJRefreshä½œä¸ºåˆ·æ–°ç®€å•å†™äº†ä¸€ä¸ªç±»åˆ«ã€SDCycleScrollViewæ˜¾ç¤ºè½®æ’­å›¾ã€Thençš„ä½¿ç”¨,æœ€ç»ˆå®ç°äº†ä¸€ä¸ªç®€å•çš„ç•Œé¢â€¦æ›´åŠ æ·±å…¥æŠ€æœ¯è¿˜åœ¨æ¢ç©¶ä¸­ï¼Œå…ˆæ”¾ä¸Šæœ¬æ–‡çš„<a href="https://github.com/ws1227/swiftLearn" target="_blank" rel="external">Demo</a><br><img src="http://art13.photozou.jp/pub/534/3167534/photo/249126056_624.v1499417867.png" alt="ç¤ºä¾‹å›¾ç‰‡"></p>
<p>æ—¢ç„¶æ˜¯ä»‹ç»Moyaçš„å°±ä¸»è¦å…ˆæ¥ä»‹ç»å®ƒå§ï¼ŒMoyaæ˜¯å¯¹ Alamofireçš„è¿›ä¸€æ­¥å°è£…,ç®€åŒ–äº†ç½‘ç»œè¯·æ±‚,æ–¹ä¾¿ç»´æŠ¤<br>,æ–¹ä¾¿å•å…ƒæµ‹è¯•,ä½¿ç”¨Moyaé¡¹ç›®ä¸­ç½‘ç»œè¯·æ±‚ç±»çš„éƒ¨åˆ†å¯èƒ½é•¿<a href="https://github.com/ws1227/swiftLearn/blob/master/Tool/ApiManager.swift" target="_blank" rel="external">è¿™æ ·</a>ï¼Œæ‰€æœ‰çš„è¯·æ±‚é›†ä¸­æ”¾åœ¨ä¸€èµ·ï¼Œé›†ä½“åŒ–ç®¡ç†å¾ˆæ–¹ä¾¿</p>
<p><a href="https://github.com/Moya/Moya/tree/master/docs" target="_blank" rel="external">ç‚¹å‡»æŸ¥çœ‹å®˜æ–¹æ•™ç¨‹</a></p>
<h4 id="Moyaå‘é€ç®€å•çš„ç½‘ç»œè¯·æ±‚"><a href="#Moyaå‘é€ç®€å•çš„ç½‘ç»œè¯·æ±‚" class="headerlink" title="Moyaå‘é€ç®€å•çš„ç½‘ç»œè¯·æ±‚"></a>Moyaå‘é€ç®€å•çš„ç½‘ç»œè¯·æ±‚</h4><p>æšä¸¾ç±»å‹éœ€æ»¡è¶³TargetTypeåè®®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public protocol TargetType &#123;</div><div class="line">var baseURL: NSURL &#123; get &#125;</div><div class="line">var path: String &#123; get &#125;</div><div class="line">var method: Moya.Method &#123; get &#125;</div><div class="line">var parameters: [String: AnyObject]? &#123; get &#125;</div><div class="line">var sampleData: NSData &#123; get &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å®ç°ä¸€ä¸ªæšä¸¾ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div></pre></td><td class="code"><pre><div class="line">import Foundation</div><div class="line">import Moya</div><div class="line"></div><div class="line">enum ApiManager &#123;</div><div class="line">case getDantangList(String)</div><div class="line">case getNewsList</div><div class="line">case getMoreNews(String)</div><div class="line">case getThemeList</div><div class="line">case getThemeDesc(Int)</div><div class="line">case getNewsDesc(Int)</div><div class="line">case Create(title: String, body: String, userId: Int)</div><div class="line">case Login(phone:String,password:String)</div><div class="line">case Banner(String)</div><div class="line">&#125;</div><div class="line"></div><div class="line">extension ApiManager: TargetType &#123;</div><div class="line">/// The target&apos;s base `URL`.</div><div class="line">var baseURL: URL &#123;</div><div class="line">switch self &#123;</div><div class="line">case .Create(_,_,_):</div><div class="line">return URL.init(string: &quot;http://jsonplaceholder.typicode.com/&quot;)!</div><div class="line">case .getDantangList,.Banner:</div><div class="line">return URL.init(string: &quot;http://api.dantangapp.com/&quot;)!</div><div class="line">case .Login:</div><div class="line">return URL.init(string: &quot;https://api.grtstar.cn&quot;)!</div><div class="line">default:</div><div class="line">return URL.init(string: &quot;http://news-at.zhihu.com/api/&quot;)!</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/// The path to be appended to `baseURL` to form the full `URL`.</div><div class="line">var path: String &#123;</div><div class="line">switch self &#123;</div><div class="line">case .getDantangList(let page):</div><div class="line">return &quot;v1/channels/\(page)/items&quot;</div><div class="line">case .getNewsList:</div><div class="line">return &quot;4/news/latest&quot;</div><div class="line">case .getMoreNews(let date):</div><div class="line">return &quot;4/news/before/&quot; + date</div><div class="line">case .getThemeList:</div><div class="line">return &quot;4/themes&quot;</div><div class="line">case .getThemeDesc(let id):</div><div class="line">return &quot;4/theme/\(id)&quot;</div><div class="line">case .getNewsDesc(let id):</div><div class="line">return &quot;4/news/\(id)&quot;</div><div class="line">case .Create(_, _, _):</div><div class="line">return &quot;posts&quot;</div><div class="line">case .Login:</div><div class="line">return &quot;/rest/user/certificate&quot;</div><div class="line">case .Banner:</div><div class="line">return &quot;v1/banners&quot;</div><div class="line"></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/// The HTTP method used in the request.</div><div class="line">var method: Moya.Method &#123;</div><div class="line">switch self &#123;</div><div class="line"></div><div class="line">case .Create(_, _, _):</div><div class="line">return .post</div><div class="line">case .Login:</div><div class="line">return .post</div><div class="line">default:</div><div class="line">return .get</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">/// The parameters to be incoded in the request.</div><div class="line">var parameters: [String: Any]? &#123;</div><div class="line">switch self &#123;</div><div class="line">case .Create(let title, let body, let userId):</div><div class="line">return [&quot;title&quot;: title, &quot;body&quot;: body, &quot;userId&quot;: userId]</div><div class="line"></div><div class="line">case .Login(let number, let passwords):</div><div class="line">return [&quot;mobile&quot; : number, &quot;password&quot; :  passwords,&quot;deviceId&quot;: &quot;12121312323&quot;]</div><div class="line">case .Banner(let strin):</div><div class="line">return [&quot;channel&quot; :strin]</div><div class="line"></div><div class="line">default:</div><div class="line">return nil</div><div class="line"></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/// The method used for parameter encoding.</div><div class="line">var parameterEncoding: ParameterEncoding &#123;</div><div class="line">return URLEncoding.default</div><div class="line">&#125;</div><div class="line"></div><div class="line">/// Provides stub data for use in testing.</div><div class="line">var sampleData: Data &#123;</div><div class="line"></div><div class="line">switch self &#123;</div><div class="line">case .Create(_, _, _):</div><div class="line">return &quot;Create post successfully&quot;.data(using: String.Encoding.utf8)!</div><div class="line">default:</div><div class="line">return &quot;&quot;.data(using: String.Encoding.utf8)!</div><div class="line"></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var task: Task &#123;</div><div class="line">return .request</div><div class="line">&#125;</div><div class="line"></div><div class="line">/// Whether or not to perform Alamofire validation. Defaults to `false`.</div><div class="line">var validate: Bool &#123;</div><div class="line">return false</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ç°åœ¨å°±å¯ä»¥å‘é€ç®€å•çš„ç½‘ç»œè¯·æ±‚äº†"><a href="#ç°åœ¨å°±å¯ä»¥å‘é€ç®€å•çš„ç½‘ç»œè¯·æ±‚äº†" class="headerlink" title="ç°åœ¨å°±å¯ä»¥å‘é€ç®€å•çš„ç½‘ç»œè¯·æ±‚äº†:"></a>ç°åœ¨å°±å¯ä»¥å‘é€ç®€å•çš„ç½‘ç»œè¯·æ±‚äº†:</h4><p>1.å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡MoyaProvider</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">let ApiManagerProvider = MoyaProvider&lt;ApiManager&gt;</div></pre></td></tr></table></figure>
<p>2.å‘é€ç½‘ç»œè¯·æ±‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ApiManagerProvider.request(.getNewsList) &#123; (result) -&gt; () in</div><div class="line">case let .success(response):</div><div class="line">break</div><div class="line">case let .failure(error):</div><div class="line">break  </div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="MoyaProviderçš„åˆå§‹åŒ–"><a href="#MoyaProviderçš„åˆå§‹åŒ–" class="headerlink" title="MoyaProviderçš„åˆå§‹åŒ–"></a>MoyaProviderçš„åˆå§‹åŒ–</h4><p>æˆ‘ä»¬è§‚å¯Ÿä¸‹MoyaProviderçš„åˆå§‹åŒ–æ–¹æ³•. MoyaProvideråˆå§‹åŒ–éƒ½æ˜¯æœ‰é»˜è®¤å€¼çš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public init(endpointClosure: @escaping EndpointClosure = MoyaProvider.defaultEndpointMapping,</div><div class="line">requestClosure: @escaping RequestClosure = MoyaProvider.defaultRequestMapping,</div><div class="line">stubClosure: @escaping StubClosure = MoyaProvider.neverStub,</div><div class="line">manager: Manager = MoyaProvider&lt;Target&gt;.defaultAlamofireManager(),</div><div class="line">plugins: [PluginType] = [],</div><div class="line">trackInflights: Bool = false)</div></pre></td></tr></table></figure>
<p>è¿™äº›å¯é€‰å‚æ•°å°±æ˜¯Moyaçš„å¼ºå¤§ä¹‹å¤„äº† ï¼Œæ–‡ç« ä¸»è¦ä¹Ÿæ˜¯ä»‹ç»å¦‚ä½•ä½¿ç”¨è¿™äº›æ’ä»¶çš„ã€‚</p>
<h4 id="å‚æ•°è¯´æ˜ï¼š"><a href="#å‚æ•°è¯´æ˜ï¼š" class="headerlink" title="å‚æ•°è¯´æ˜ï¼š"></a>å‚æ•°è¯´æ˜ï¼š</h4><ul>
<li>EndpointClosure<br>å¯ä»¥å¯¹è¯·æ±‚å‚æ•°åšè¿›ä¸€æ­¥çš„ä¿®æ”¹,å¦‚å¯ä»¥ä¿®æ”¹endpointByAddingParameters endpointByAddingHTTPHeaderFieldsç­‰</li>
<li>RequestClosure ä½ å¯ä»¥åœ¨å‘é€è¯·æ±‚å‰ï¼Œåšç‚¹æ‰‹è„š. å¦‚ä¿®æ”¹è¶…æ—¶æ—¶é—´ï¼Œæ‰“å°ä¸€äº›æ•°æ®ç­‰ç­‰</li>
<li>StubClosureå¯ä»¥è®¾ç½®è¯·æ±‚çš„å»¶è¿Ÿæ—¶é—´,å¯ä»¥å½“åšæ¨¡æ‹Ÿæ…¢é€Ÿç½‘ç»œ</li>
<li>Manager è¯·æ±‚ç½‘ç»œè¯·æ±‚çš„æ–¹å¼ã€‚é»˜è®¤æ˜¯Alamofire</li>
<li>[PluginType]ä¸€äº›æ’ä»¶ã€‚å›è°ƒçš„ä½ç½®åœ¨å‘é€è¯·æ±‚åï¼Œæ¥å—æœåŠ¡å™¨è¿”å›ä¹‹å‰</li>
</ul>
<p>ç¨åè¯¦ç»†ä»‹ç»è¿™éƒ¨åˆ†å†…å®¹ã€‚</p>
<h4 id="RxSwift"><a href="#RxSwift" class="headerlink" title="RxSwift"></a>RxSwift</h4><p>Moyaä¹Ÿæœ‰è‡ªå·±çš„RxSwiftçš„æ‰©å±•ï¼Œä¸æ‡‚RxSwiftçš„ç«¥é‹å¯ä»¥çœ‹ä¸‹æˆ‘ä»¬åšå®¢ä¸­çš„å…³äºRxSwiftåº“ä»‹ç»çš„æ–‡ç« ã€‚Moyaä½¿ç”¨RxSwiftå¾ˆç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºæˆ‘ä»¬åªéœ€è¦å¯¹è¯·æ±‚ç»“æœè¿›è¡Œç›‘å¬å°±è¡Œäº†</p>
<blockquote>
<p>ä½¿ç”¨RxSwiftå¯ä»¥è¿™æ ·æ¥è¯·æ±‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">let provider = RxMoyaProvider&lt;ApiManager&gt;()//è¦ä½¿ç”¨RxMoyaProvideråˆ›å»ºproviderï¼Œæš‚æ—¶ä¸æºå¸¦ä»»ä½•å‚æ•°</div><div class="line">provider.request(.getNewsList).subscribe &#123; event in</div><div class="line">switch event &#123;</div><div class="line">case .next(let response):</div><div class="line">// do something with the data</div><div class="line">case .error(let error):</div><div class="line">// handle the error</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜å¯ä»¥å¯¹Observableè¿›è¡Œæ‰©å±•ï¼Œè‡ªå®šä¹‰ä¸€äº›è‡ªå·±æµæ°´çº¿æ“ä½œï¼Œæ¯”å¦‚è‡ªåŠ¨å®ç°jsonè½¬åŒ–Modelï¼Œå®šä¹‰å¦‚ä¸‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">func mapObject&lt;T: Mappable&gt;(type: T.Type) -&gt; Observable&lt;T&gt; &#123;</div><div class="line">return self.map &#123; response in</div><div class="line">//if response is a dictionary, then use ObjectMapper to map the dictionary</div><div class="line">//if not throw an error</div><div class="line">guard let dict = response as? [String: Any] else &#123;</div><div class="line">throw RxSwiftMoyaError.ParseJSONError</div><div class="line">&#125;</div><div class="line">guard (dict[&quot;code&quot;] as?Int) != nil else&#123;</div><div class="line">throw RxSwiftMoyaError.ParseJSONError</div><div class="line">&#125;</div><div class="line"></div><div class="line">if let error = self.parseError(response: dict) &#123;</div><div class="line">throw error</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">return Mapper&lt;T&gt;().map(JSON: dict)!</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸‹è¾¹çš„æ–¹æ³•å°±éœ€è¦æ ¹æ®æœåŠ¡å™¨è¿”å›æ•°æ®è¿›è¡Œåˆ¤æ–­äº†ï¼Œæˆ‘å¸¸ç”¨çš„é€»è¾‘æ˜¯æ•°æ®è¯·æ±‚æˆåŠŸäº†æ‰è¿”å›å†å°±è¡Œç•Œé¢èµ‹å€¼åˆ·æ–°æ“ä½œï¼Œå¦‚æœæ˜¯çŠ¶æ€ç ä¸æˆåŠŸå°±ç›´æ¥æ‹¦æˆªæŠ›å‡ºé”™è¯¯ï¼ˆåå°è¿”å›çš„messageï¼‰ï¼Œæ¯”å¦‚æ˜¯ç™»å½•å¯†ç é”™è¯¯æç¤ºä¹‹ç±»çš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">fileprivate func parseError(response: [String: Any]?) -&gt; NSError? &#123;</div><div class="line">var error: NSError?</div><div class="line">if let value = response &#123;</div><div class="line">var code:Int?</div><div class="line"></div><div class="line">//åå°çš„æ•°æ®æ¯æ¬¡ä¼šè¿”å›codeåªæœ‰æ˜¯200æ‰ä¼šè¡¨ç¤ºé€»è¾‘æ­£å¸¸æ‰§è¡Œ</div><div class="line">if let codes = value[&quot;code&quot;] as?Int</div><div class="line">&#123;</div><div class="line">code = codes</div><div class="line"></div><div class="line">&#125;</div><div class="line">if  code != 200 &#123;</div><div class="line">var msg = &quot;&quot;</div><div class="line">if let message = value[&quot;message&quot;] as? String &#123;</div><div class="line">msg = message</div><div class="line">&#125;</div><div class="line">error = NSError(domain: &quot;Network&quot;, code: code!, userInfo: [NSLocalizedDescriptionKey: msg])</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">return error</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>é‚£ä¹ˆå°±å¯ä»¥å®šä¹‰ä¸€ä¸ªè¯·æ±‚æ–¹æ³•äº† </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">func login(phone: String, password:String) -&gt; Observable&lt;UserModel&gt; &#123;</div><div class="line">return provider.request(.Login(phone: phone, password: password))</div><div class="line">.mapJSON()</div><div class="line">.debug() // æ‰“å°è¯·æ±‚å‘é€ä¸­çš„è°ƒè¯•ä¿¡æ¯</div><div class="line"></div><div class="line">.mapObject(type: UserModel.self)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚ä¸‹ä»£ç å°±å®Œæˆäº†ä¸€æ¬¡è¯·æ±‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">let viewModel  = ViewModel(self)</div><div class="line">viewModel.login(phone: &quot;156178....&quot; , password: &quot;11111&quot;)</div><div class="line">.subscribe(onNext: &#123; (userModel: UserModel) in</div><div class="line">//do something with posts</div><div class="line">print(userModel.user?.nickName ?? &quot;&quot;)</div><div class="line"></div><div class="line">&#125;)</div><div class="line">.addDisposableTo(dispose)</div></pre></td></tr></table></figure>
<p>Moyaä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šObservableçš„æ‰©å±•ï¼Œè®©æˆ‘ä»¬èƒ½æ›´è½»æ¾çš„å¤„ç†MoyaResponseï¼Œå¸¸ç”¨çš„å¦‚ä¸‹ï¼š</p>
<ul>
<li>filter(statusCodes:) è¿‡æ»¤responseçŠ¶æ€ç </li>
<li>filterSuccessfulStatusCodes() è¿‡æ»¤çŠ¶æ€ç ä¸ºè¯·æ±‚æˆåŠŸçš„</li>
<li>mapJSON() å°†è¯·æ±‚responseè½¬åŒ–ä¸ºJSONæ ¼å¼</li>
<li>mapString() å°†è¯·æ±‚responseè½¬åŒ–ä¸ºStringæ ¼å¼</li>
</ul>
<p>å…·ä½“å¯ä»¥å‚è€ƒ<a href="https://github.com/Moya/Moya/blob/master/docs/RxSwift.md" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></p>
<hr>
<p>ä¸‹è¾¹å°±è¯´è¯´RxMoyaProviderå‚æ•°å§</p>
<h4 id="EndpointClosure"><a href="#EndpointClosure" class="headerlink" title="EndpointClosure"></a>EndpointClosure</h4><blockquote>
<p>æ²¡å†™ä»€ä¹ˆå°±æ‰“å°ä¸‹å‚æ•°ï¼Œè¯·æ±‚æ–¹æ³•ï¼Œè·¯å¾„..å¯ä»¥æ ¸å¯¹</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">private func endpointMapping&lt;Target: TargetType&gt;(target: Target) -&gt; Endpoint&lt;Target&gt; &#123;</div><div class="line"></div><div class="line"></div><div class="line">print(&quot;è¯·æ±‚è¿æ¥ï¼š\(target.baseURL)\(target.path) \næ–¹æ³•ï¼š\(target.method)\nå‚æ•°ï¼š\(String(describing: target.parameters)) &quot;)</div><div class="line"></div><div class="line"></div><div class="line">return MoyaProvider.defaultEndpointMapping(for: target)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="manager"><a href="#manager" class="headerlink" title="manager"></a>manager</h4><blockquote>
<p>ç”¨çš„æ˜¯Alamofireè¯·æ±‚ï¼Œè¿™é‡Œä¸»è¦å†™äº†ä¸€ä¸ªå¿½ç•¥SSLéªŒè¯çš„æ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œä¿®æ”¹è¯·æ±‚å¤´ç­‰ç­‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public func defaultAlamofireManager() -&gt; Manager &#123;</div><div class="line"></div><div class="line"></div><div class="line">let configuration = URLSessionConfiguration.default</div><div class="line">configuration.httpAdditionalHeaders = Alamofire.SessionManager.defaultHTTPHeaders</div><div class="line"></div><div class="line">let policies: [String: ServerTrustPolicy] = [</div><div class="line"></div><div class="line">&quot;ap.dimain.cn&quot;: .disableEvaluation</div><div class="line">]</div><div class="line">let manager = Alamofire.SessionManager(configuration: configuration,serverTrustPolicyManager: ServerTrustPolicyManager(policies: policies))</div><div class="line"></div><div class="line">manager.startRequestsImmediately = false</div><div class="line">return manager</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<p>æœ€æœ‰æ„æ€çš„è¿˜æ˜¯æ’ä»¶äº† ï¼Œå¯ä»¥è‡ªå®šä¹‰å„ç§åŠŸèƒ½</p>
<h4 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h4><p>pluginså‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„çš„å½¢å¼ï¼Œéµå¾ªPluginTypeåè®®æˆ‘ä»¬å…ˆçœ‹ä¸‹PluginTypeçš„åè®®å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">public protocol PluginType &#123;</div><div class="line">/// Called to modify a request before sending</div><div class="line">//è¯·æ±‚å‰å¯ä»¥ä¿®æ”¹ä¸€äº›request</div><div class="line">func prepare(_ request: URLRequest, target: TargetType) -&gt; URLRequest</div><div class="line"></div><div class="line">/// Called immediately before a request is sent over the network (or stubbed).</div><div class="line">//å¼€å§‹è¯·æ±‚</div><div class="line">func willSend(_ request: RequestType, target: TargetType)</div><div class="line"></div><div class="line">/// Called after a response has been received, but before the MoyaProvider has invoked its completion handler.</div><div class="line">//ç»“æŸè¯·æ±‚</div><div class="line">func didReceive(_ result: Result&lt;Moya.Response, MoyaError&gt;, target: TargetType)</div><div class="line"></div><div class="line">/// Called to modify a result before completion</div><div class="line">func process(_ result: Result&lt;Moya.Response, MoyaError&gt;, target: TargetType) -&gt; Result&lt;Moya.Response, MoyaError&gt;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>çŠ¶æ€æ¡ä¸­çš„ç½‘ç»œåŠ è½½æç¤º,ä¿—ç§°â€èŠèŠ±åŠ è½½â€</p>
<h4 id="networkActivityPlugin"><a href="#networkActivityPlugin" class="headerlink" title="networkActivityPlugin"></a>networkActivityPlugin</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">let networkActivityPlugin = NetworkActivityPlugin &#123; (change) -&gt; () in</div><div class="line"></div><div class="line"></div><div class="line">switch(change)&#123;</div><div class="line"></div><div class="line">case .ended:</div><div class="line"></div><div class="line">UIApplication.shared.isNetworkActivityIndicatorVisible = false</div><div class="line"></div><div class="line">case .began:</div><div class="line"></div><div class="line">UIApplication.shared.isNetworkActivityIndicatorVisible = true</div><div class="line"></div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>NetworkActivityPluginæ˜¯Moyaæä¾›çš„æ–¹æ³•ï¼Œè¿˜æ˜¯æ ¹æ®PluginTypeçš„åè®®å®ç°çš„</p>
<blockquote>
<p>è¯·æ±‚ä¸€èˆ¬å°±éœ€è¦loadingäº†è¿™é‡Œç”¨MBProgressHUDå®ç°è‡ªåŠ¨æ˜¾ç¤ºéšè—</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">public final class RequestLoadingPlugin: PluginType &#123;</div><div class="line">private let viewController: UIViewController</div><div class="line">var HUD:MBProgressHUD</div><div class="line">var hide:Bool</div><div class="line"></div><div class="line">init(_ vc: UIViewController,_ hideView:Bool) &#123;</div><div class="line">self.viewController = vc</div><div class="line">self.hide = hideView</div><div class="line">HUD = MBProgressHUD.init()</div><div class="line">guard self.hide else &#123;</div><div class="line"></div><div class="line">return</div><div class="line">&#125;</div><div class="line">HUD = MBProgressHUD.showAdded(to: self.viewController.view, animated: true)</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">public func willSend(_ request: RequestType, target: TargetType) &#123;</div><div class="line">print(&quot;å¼€å§‹è¯·æ±‚\(self.viewController)&quot;)</div><div class="line"></div><div class="line">if self.hide  != false  &#123;</div><div class="line"></div><div class="line">HUD.mode = MBProgressHUDMode.indeterminate</div><div class="line">HUD.label.text = &quot;åŠ è½½ä¸­&quot;</div><div class="line">HUD.bezelView.color = UIColor.lightGray</div><div class="line"></div><div class="line">HUD.removeFromSuperViewOnHide = true</div><div class="line">HUD.backgroundView.style = .solidColor //æˆ–SolidColor</div><div class="line"></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public func didReceive(_ result: Result&lt;Response, MoyaError&gt;, target: TargetType) &#123;</div><div class="line">print(&quot;ç»“æŸè¯·æ±‚&quot;)</div><div class="line">HUD.hide(animated: true)</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>ä¿®æ”¹è¯·æ±‚å¤´æƒ³æƒ³ä¸è¯¥æ”¾åœ¨æ’ä»¶äº†å®ç°ï¼Œåº”è¯¥æ˜¯åœ¨manageré‡Œå®ç°ï¼Œå…ˆæ”¾å‡ºæ¥ä»£ç å§</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">struct AuthPlugin: PluginType &#123;</div><div class="line">let token: String</div><div class="line"></div><div class="line">func prepare(_ request: URLRequest, target: TargetType) -&gt; URLRequest &#123;</div><div class="line">var request = request</div><div class="line">request.timeoutInterval = 30</div><div class="line">request.addValue(token, forHTTPHeaderField: &quot;token&quot;)</div><div class="line">request.addValue(&quot;ios&quot;, forHTTPHeaderField: &quot;platform&quot;)</div><div class="line">request.addValue(&quot;version&quot;, forHTTPHeaderField: Bundle.main.object(forInfoDictionaryKey: &quot;CFBundleShortVersionString&quot;) as! String)</div><div class="line">return request</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¯·æ±‚æ—¶å€™é‡åˆ°é€»è¾‘é”™è¯¯æˆ–è€…ä¸æ»¡è¶³æ¡ä»¶ï¼Œå‚æ•°é”™è¯¯ç­‰è¦æç¤ºè¿™é‡Œç”¨çš„æ˜¯Toast</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">//æ£€æµ‹tokenæœ‰æ•ˆæ€§</div><div class="line">final class AccessTokenPlugin: PluginType &#123;</div><div class="line">private let viewController: UIViewController</div><div class="line"></div><div class="line">init(_ vc: UIViewController) &#123;</div><div class="line">self.viewController = vc</div><div class="line">&#125;</div><div class="line"></div><div class="line">public func willSend(_ request: RequestType, target: TargetType) &#123;&#125;</div><div class="line">public func didReceive(_ result: Result&lt;Response, MoyaError&gt;, target: TargetType) &#123;</div><div class="line">switch result &#123;</div><div class="line">case .success(let response):</div><div class="line">//è¯·æ±‚çŠ¶æ€ç </div><div class="line">guard  response.statusCode == 200   else &#123;</div><div class="line">return</div><div class="line">&#125;</div><div class="line">var json:Dictionary? = try! JSONSerialization.jsonObject(with: response.data,options:.allowFragments) as! [String: Any]</div><div class="line">print(&quot;è¯·æ±‚çŠ¶æ€ç \(json?[&quot;status&quot;] ?? &quot;&quot;)&quot;)</div><div class="line">guard (json?[&quot;message&quot;]) != nil  else &#123;</div><div class="line">return</div><div class="line">&#125;</div><div class="line">guard let codeString = json?[&quot;status&quot;]else &#123;return&#125;</div><div class="line">//è¯·æ±‚çŠ¶æ€ä¸º1æ—¶å€™ç«‹å³è¿”å›ä¸å¼¹å‡ºä»»ä½•æç¤º å¦åˆ™æç¤ºåå°è¿”å›çš„é”™è¯¯ä¿¡æ¯</div><div class="line">guard codeString as! Int != 1 else&#123;return&#125;</div><div class="line">self.viewController.view .makeToast( json?[&quot;message&quot;] as! String)</div><div class="line"></div><div class="line">case .failure(let error):</div><div class="line">print(&quot;å‡ºé”™äº†\(error)&quot;)</div><div class="line"></div><div class="line">break</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>AccessTokenPluginè¿™ä¸ªåå­—æœ‰ç‚¹é—®é¢˜å“ˆï¼Œèµ·åˆæ˜¯æƒ³åœ¨è¿™é‡Œåˆ¤æ–­tokenä¸æ­£ç¡®å°±é€€å‡ºç™»å½•ç”¨çš„ç”±äºæ²¡æœ‰åˆé€‚çš„apiå°±å®ç°äº†è¯·æ±‚ç»“æœçš„çŠ¶æ€åˆ¤æ–­ï¼Œè¿™å°±è‡ªåŠ¨å®ç°äº†é€»è¾‘é”™è¯¯çš„æç¤ºäº† ä¸ç”¨ä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªè¯·æ±‚çš„åˆ¤æ–­äº†ï¼Œè¿˜æ˜¯æŒºæ–¹ä¾¿çš„</p>
<p>æœ‰äº†è¿™äº›æ’ä»¶å°±å¯ä»¥è¿™æ ·åˆå§‹åŒ–RxMoyaProvider</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">let provider :RxMoyaProvider&lt;ApiManager&gt;</div><div class="line">provider = RxMoyaProvider&lt;ApiManager&gt;(</div><div class="line">endpointClosure: endpointMapping,</div><div class="line">manager:defaultAlamofireManager(),</div><div class="line">plugins:[RequestLoadingPlugin(self.viewController,true),</div><div class="line">AccessTokenPlugin( self.viewController), NetworkLoggerPlugin(verbose: true),</div><div class="line">networkActivityPlugin,AuthPlugin(token: &quot;æš‚æ—¶ä¸ºç©º&quot;)]</div></pre></td></tr></table></figure>
<p>å…³äºMoyaçš„ç”¨æ³•å…ˆä»‹ç»åˆ°è¿™é‡Œåç»­æˆ‘ä¼šç»§ç»­æ¢ç©¶æ›´åŠ çµæ´»å…¨é¢çš„ç”¨æ³•ã€‚</p>
<hr>
<h4 id="ä¸‹è¾¹ä»‹ç»ä¸‹Thençš„è¯­æ³•æ£‰èŠ±ç³–å§ï¼Œçœ‹ä¾‹å­å§"><a href="#ä¸‹è¾¹ä»‹ç»ä¸‹Thençš„è¯­æ³•æ£‰èŠ±ç³–å§ï¼Œçœ‹ä¾‹å­å§" class="headerlink" title="ä¸‹è¾¹ä»‹ç»ä¸‹Thençš„è¯­æ³•æ£‰èŠ±ç³–å§ï¼Œçœ‹ä¾‹å­å§"></a>ä¸‹è¾¹ä»‹ç»ä¸‹<a href="https://github.com/devxoul/Then" target="_blank" rel="external">Then</a>çš„è¯­æ³•æ£‰èŠ±ç³–å§ï¼Œçœ‹ä¾‹å­å§</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">_ = UILabel.init(frame: CGRect.init(x: 0, y: 0, width: kScreenW, height: 50)).then(&#123; (make) in</div><div class="line"></div><div class="line">make.text = &quot;Thençš„ç®€å•ç”¨æ³•è¶…èµğŸ‘&quot;</div><div class="line">make.font = .systemFont(ofSize: 20)</div><div class="line">make.textColor = .red</div><div class="line">make.textAlignment = .center</div><div class="line">self.view.addSubview(make)</div><div class="line"></div><div class="line">&#125;)</div><div class="line"></div><div class="line">UserDefaults.standard.do &#123;</div><div class="line">$0.set(&quot;devxoul&quot;, forKey: &quot;username&quot;)</div><div class="line">$0.set(&quot;devxoul@gmail.com&quot;, forKey: &quot;email&quot;)</div><div class="line">$0.synchronize()</div><div class="line"></div><div class="line">let tableView = UITableView().then &#123;</div><div class="line">$0.backgroundColor = .clear</div><div class="line">$0.separatorStyle = .none</div><div class="line">$0.register(MyCell.self, forCellReuseIdentifier: &quot;myCell&quot;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœå¸ƒå±€è¿™æ ·è¿˜ä¸ç®€å•é‚£å†çœ‹ä¸‹è¾¹ç”¨<a href="https://github.com/devxoul/Then" target="_blank" rel="external">Then</a>å’Œ<a href="https://github.com/SnapKit/SnapKit" target="_blank" rel="external">SnapKit</a>ä¸€èµ·ä½¿ç”¨çš„æ–¹å¼</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">_ = UILabel().then(&#123; (make) in</div><div class="line">make.text = &quot;Thençš„ç®€å•ç”¨æ³•è¶…èµğŸ‘&quot;</div><div class="line">make.font = .systemFont(ofSize: 20)</div><div class="line">make.textColor = .red</div><div class="line">make.textAlignment = .center</div><div class="line">self.view.addSubview(make)</div><div class="line">make.snp.makeConstraints(&#123; (make) in</div><div class="line">make.top.left.right.equalTo(0)</div><div class="line">make.height.equalTo(50)</div><div class="line"></div><div class="line">&#125;)</div><div class="line"></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>å†ä¸æ»¡æ„åªèƒ½ç”¨Xibå¸ƒå±€äº†â€¦.</p>
<h4 id="åœ¨Swiftä¸­ç”¨SDCycleScrollViewè½®æ’­å›¾"><a href="#åœ¨Swiftä¸­ç”¨SDCycleScrollViewè½®æ’­å›¾" class="headerlink" title="åœ¨Swiftä¸­ç”¨SDCycleScrollViewè½®æ’­å›¾"></a>åœ¨Swiftä¸­ç”¨<a href="https://github.com/gsdios/SDCycleScrollView" target="_blank" rel="external">SDCycleScrollView</a>è½®æ’­å›¾</h4><p>SDCycleScrollViewä¹‹å‰ä¸€ç›´åœ¨OCä¸­ä½¿ç”¨è§‰å¾—å¾ˆç®€å•åˆç†Ÿæ‚‰äº†æ‰€ä»¥è¿™æ¬¡å†™çš„Demoä¾æ—§æ¬äº†è¿‡æ¥ï¼Œä½†æ˜¯å‘¢SDCycleScrollViewé‡Œå®ç°å›¾ç‰‡ä¸‹è½½ç”¨çš„æ˜¯SDWebImageï¼Œè€ŒSwiftç‰ˆæœ¬æä¾›äº†Kingfisheré‚£ä¸å¯èƒ½éƒ½ç”¨äº†ï¼Œå› ä¸ºä¹Ÿä¸æƒ³æ”¾å¼ƒSDCycleScrollViewå°±ä¸å¾—å·²ä¿®æ”¹äº†é‡Œè¾¹å›¾ç‰‡ä¸‹è½½çš„æ–¹æ³•ï¼Œåœ¨Swifté¡¹ç›®é‡ŒOCç±»ç›´æ¥è°ƒç”¨Swiftç±»æ˜¯è°ƒç”¨ä¸åˆ°çš„ï¼Œæ‰€ä»¥æˆ‘å°±å’¨è¯¢äº†ä¸‹æ‰¾åˆ°ä¸€ä¸ªåˆé€‚åŠæ³•ï¼Œæ–°å»ºSwifté‡Œç»§æ‰¿SDCycleScrollViewç„¶åç”¨Kingfisherå®ç°å›¾ç‰‡ä¸‹è½½ï¼Œæ–¹æ³•æ¯”è¾ƒç®€å•å°±æ˜¯ç»™å¼€å‘è€…æä¾›ä¸€ä¸ªå‚è€ƒæ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">import UIKit</div><div class="line">import SDCycleScrollView</div><div class="line">import Kingfisher</div><div class="line">class CustomSDCycleScrollView: SDCycleScrollView  &#123;</div><div class="line"></div><div class="line">//å› ä¸ºä¹‹å‰åº“é‡Œè¾¹ç”¨çš„æ˜¯SDWebImageView ç¼“å­˜çš„å›¾ç‰‡ ç°åœ¨ æ¢äº†Swiftç‰ˆæœ¬çš„Kingfisheræ‰€ä»¥ æ— å¥ˆä¿®æ”¹äº†åŸåº“çš„æ–¹æ³• é‡å†™äº†ä¸‹</div><div class="line">open override func imageView(_ imageView: UIImageView!, url: URL!) -&gt; UIImageView! &#123;</div><div class="line">let imageView: UIImageView? = imageView</div><div class="line">imageView?.kf.setImage(with: url,placeholder:UIImage.init(named: &quot;tab_5th_h&quot;))</div><div class="line">return imageView</div><div class="line">&#125;</div><div class="line">//é‡å†™ocä»£ç  åˆ é™¤ç¼“å­˜</div><div class="line">override class func clearImagesCache()</div><div class="line">&#123;</div><div class="line">let cache = KingfisherManager.shared.cache</div><div class="line"></div><div class="line">// è·å–ç¡¬ç›˜ç¼“å­˜çš„å¤§å°</div><div class="line">cache.calculateDiskCacheSize &#123; (size) -&gt; () in</div><div class="line">print(&quot;ç£ç›˜ç¼“å­˜å¤§å°ï¼š \(size) bytes &quot;)</div><div class="line">cache.clearDiskCache()</div><div class="line"></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç”¨çš„æ—¶å€™ç›´æ¥ä½¿ç”¨CustomSDCycleScrollViewå³å¯</p>
<h4 id="é¡¹ç›®ä½¿ç”¨MJRefreshå®ç°åˆ·æ–°"><a href="#é¡¹ç›®ä½¿ç”¨MJRefreshå®ç°åˆ·æ–°" class="headerlink" title="é¡¹ç›®ä½¿ç”¨MJRefreshå®ç°åˆ·æ–°"></a>é¡¹ç›®ä½¿ç”¨MJRefreshå®ç°åˆ·æ–°</h4><blockquote>
<p>ç»™UIScrollViewå†™äº†ä¸€ä¸ªç±»åˆ«æ¯”è¾ƒç®€å•ä»£ç å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">import UIKit</div><div class="line">import MJRefresh</div><div class="line"></div><div class="line">extension UIScrollView</div><div class="line">&#123;</div><div class="line">func headerRefresh(block: @escaping () -&gt; ()) -&gt; ()&#123;</div><div class="line"></div><div class="line">self.mj_header = MJRefreshNormalHeader.init(refreshingBlock: &#123;</div><div class="line">block()</div><div class="line"></div><div class="line">&#125;)</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div><div class="line">func footerRefresh(block: @escaping () -&gt; ()) -&gt; ()&#123;</div><div class="line"></div><div class="line">self.mj_footer = MJRefreshBackNormalFooter(refreshingBlock: &#123;</div><div class="line">block()</div><div class="line"></div><div class="line">&#125;)</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">func endrefresh()&#123;</div><div class="line"></div><div class="line">self.mj_footer.endRefreshing()</div><div class="line">self.mj_header.endRefreshing()</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<p>ç”¨çš„æ—¶å€™æ›´ç®€å•äº†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">weak var weakself = self</div><div class="line">//ä¸Šæ‹‰åˆ·æ–°</div><div class="line">tableView.headerRefresh &#123;</div><div class="line">weakself?.loadData()</div><div class="line">&#125;</div><div class="line">//ä¸‹æ‹‰åŠ è½½</div><div class="line">tableView.footerRefresh&#123;</div><div class="line">weakself?.loadData()</div><div class="line">&#125;</div><div class="line">//ç»“æŸåˆ·æ–°</div><div class="line">self.tableView.endrefresh()</div></pre></td></tr></table></figure>
<p>å€¼å¾—ä¸€æçš„æ˜¯<a href="http://wangsen.website/posts/28457/" target="_blank" rel="external">Swifté¡¹ç›®å¦‚ä½•ç”¨OC</a></p>
<p>ä¸‹ç­äº†ã€‚ã€‚ã€‚ã€‚åç»­æ›´æ–°</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="www.wangsen.website/posts/46398/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹æ£®">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹æ£®åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/posts/46398/" itemprop="url">
                  AFNetworkingå’ŒAlamofireè®¾ç½®è·³è¿‡https(SSL)éªŒè¯
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-07-07T11:47:01+08:00">
                2017-07-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/posts/46398/" class="leancloud_visitors" data-flag-title="AFNetworkingå’ŒAlamofireè®¾ç½®è·³è¿‡https(SSL)éªŒè¯">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æˆ‘ä»¬æœåŠ¡å™¨ç”¨çš„æ˜¯httpsä½†æ˜¯æ²¡ç”¨è¯ä¹¦ï¼Œå®¢æˆ·ç«¯ä¸éªŒè¯ï¼Œåœ¨ios11ä¹‹å‰æ˜¯ä¸ç”¨åšå¤„ç†çš„ï¼Œåœ¨ä¸‹è½½äº†ios11ä¹‹åå‘ç°è¯·æ±‚å¤±è´¥äº†ï¼Œå°±æ˜¯è¯ä¹¦éªŒè¯å¤±è´¥ï¼Œæƒ³å¿…æ˜¯è¿™æ¬¡ç‰ˆæœ¬æ›´æ–°çš„ä¸€ç‚¹å°å˜åŒ–å§ã€‚</p>
<p>ç°åœ¨é¡¹ç›®ç”¨çš„æ˜¯AFNetworking 3.0.2ç‰ˆæœ¬æŠ¥é”™<br></p>
<blockquote>
<p>Error Domain=NSURLErrorDomain Code=-999 â€œå·²å–æ¶ˆâ€ </p>
</blockquote>
<p><br>ç„¶åæ¢äº†swiftçš„Alamofireè¯·æ±‚æŠ¥é”™æ˜¯ <br></p>
<blockquote>
<p>Domain=NSURLErrorDomain Code=-1202 â€œThe certificate for this server is invalid. You might be connecting to a server that is pretending to be â€œapi.domain.cnâ€ which could put your confidential information at risk.â€ UserInfo={NSURLErrorFailingURLPeerTrustErrorKey=<sectrustref: 0x1c010efa0="">, NSLocalizedRecoverySuggestion=Would you like to connect to the server anyway?, _kCFStreamErrorDomainKey=3, _kCFStreamErrorCodeKey=-9807â€¦.<br><br></sectrustref:></p>
</blockquote>
<p>æ€»ä¹‹å°±æ˜¯è¯ä¹¦çš„é—®é¢˜äº†ï¼Œæˆ‘ä»¬æœåŠ¡å™¨æ˜¯æ²¡æœ‰éªŒè¯è¯ä¹¦çš„ æ‰€ä»¥éœ€è¦å‰ç«¯è¿™è¾¹å£°æ˜è·³è¿‡éªŒè¯çš„</p>
<p>ç½‘ä¸ŠæŸ¥äº†ä¸‹æ‰¾åˆ°äº†å¦‚ä¸‹è§£å†³åŠæ³•</p>
<blockquote>
<p>OCçš„ä»£ç å¦‚ä¸‹</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">AFSecurityPolicy *securityPolicy = [AFSecurityPolicy policyWithPinningMode:AFSSLPinningModeNone];</div><div class="line">// allowInvalidCertificates æ˜¯å¦å…è®¸æ— æ•ˆè¯ä¹¦ï¼ˆä¹Ÿå°±æ˜¯è‡ªå»ºçš„è¯ä¹¦ï¼‰ï¼Œé»˜è®¤ä¸ºNO</div><div class="line">// å¦‚æœæ˜¯éœ€è¦éªŒè¯è‡ªå»ºè¯ä¹¦ï¼Œéœ€è¦è®¾ç½®ä¸ºYES</div><div class="line">securityPolicy.allowInvalidCertificates = YES;</div><div class="line">[securityPolicy setValidatesDomainName:NO];</div><div class="line">[manger setSecurityPolicy:securityPolicy];</div></pre></td></tr></table></figure>
<blockquote>
<p>Swiftç”¨Alamofireè§£å†³æ–¹æ¡ˆ </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public func defaultAlamofireManager() -&gt; Manager &#123;</div><div class="line">    let configuration = URLSessionConfiguration.default</div><div class="line">    configuration.httpAdditionalHeaders = Alamofire.SessionManager.defaultHTTPHeaders</div><div class="line"></div><div class="line">    let policies: [String: ServerTrustPolicy] = [</div><div class="line">       </div><div class="line">        &quot;api.domian.cn&quot;: .disableEvaluation</div><div class="line">    ]</div><div class="line">    let manager = Alamofire.SessionManager(configuration: configuration,serverTrustPolicyManager: ServerTrustPolicyManager(policies: policies))</div><div class="line">    </div><div class="line">    manager.startRequestsImmediately = false</div><div class="line">    return manager</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="www.wangsen.website/posts/25894/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹æ£®">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹æ£®åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/posts/25894/" itemprop="url">
                  ä½¿ç”¨DZNEmptyDataSetæ—¶DZNEmptyDataSetViewè‡ªåŠ¨ä¸Šç§»
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-07-05T14:56:41+08:00">
                2017-07-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/posts/25894/" class="leancloud_visitors" data-flag-title="ä½¿ç”¨DZNEmptyDataSetæ—¶DZNEmptyDataSetViewè‡ªåŠ¨ä¸Šç§»">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä½¿ç”¨DZNEmptyDataSeté‡åˆ°çš„ä¸€ä¸ªé—®é¢˜</p>
<blockquote>
<p>ä»Šå¤©åœ¨ä½¿ç”¨DZNEmptyDataSeté‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ç”¨MJRefresh åDZNEmptyDataSet Viewçš„æ•´ä¸ªèƒŒæ™¯å°ºå¯¸ä¸å¯¹ã€‚<br><br>ps: DZNEmptyDataSetæ˜¯ä¸€ä¸ªç›¸å½“ä¸é”™è®¾ç½®ç©ºç™½é¡µé¢çš„è½®å­éå¸¸ å¥½ä½¿ ã€‚</p>
</blockquote>
<p>æ— è®ºæ˜¯ç”¨è‡ªå®šä¹‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (UIView *)customViewForEmptyDataSet:(UIScrollView *)scrollView</div></pre></td></tr></table></figure>
<p>è¿˜æ˜¯ç›´æ¥ç”¨ DZNEmptyDataSet æ¨èçš„æ–¹å¼ç›´æ¥è®¾ç½®éƒ½æ˜¯æœ‰é—®é¢˜çš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (UIImage *)imageForEmptyDataSet:(UIScrollView *)scrollView;</div><div class="line">- (NSAttributedString *)descriptionForEmptyDataSet:(UIScrollView *)scrollView</div><div class="line">- (NSAttributedString *)buttonTitleForEmptyDataSet:(UIScrollView *)scrollView forState:(UIControlState)state</div></pre></td></tr></table></figure>
<blockquote>
<p>çœ‹çœ‹é—®é¢˜çš„å…·ä½“è¡¨ç°å§</p>
</blockquote>
<p><img src="http://art21.photozou.jp/pub/534/3167534/photo/249087175_624.v1499234910.png" alt="æ­£å¸¸çš„å›¾ç‰‡"></p>
<blockquote>
<p>ä¸‹è¾¹è¿™ä¸ªå°±æ˜¯ æœ‰é—®é¢˜äº†ï¼Œæ²¡æ•°æ®åè‡ªåŠ¨ä¸Šç§»äº† </p>
</blockquote>
<p><img src="http://art5.photozou.jp/pub/534/3167534/photo/249087171_624.v1499234903.png" alt="éæ­£å¸¸å›¾ç‰‡"></p>
<p>ç®€å•çš„è¯´é—®é¢˜æ˜¯ï¼šåˆ·æ–°åDZNEmptyDataSetView è¿˜ä¼šå‘ä¸Šåç§»ä¸€æ®µè·ç¦»ï¼<br><br>å°è¯•å„ç§åˆ·æ–°éƒ½æ²¡æœ‰ç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[self.tableView reloadEmptyDataSet];  </div><div class="line">[self.tableView reloadData];</div></pre></td></tr></table></figure>
<p>çœ‹äº†ä¸‹è§†å›¾çš„å±‚æ¬¡å…³ç³»<br><br><img src="http://art5.photozou.jp/pub/534/3167534/photo/249087178_624.v1499234916.jpg" alt="å±‚æ¬¡å…³ç³»å›¾"><br>å¯ä»¥çœ‹å‡ºäº†DZNEmptyDataSetViewä¸Šç§»äº†54ï¼Œç„¶åæˆ‘ä¸€æœ 54 ï¼Œå‘ç°54å‡ºç°åœ°æ–¹å¹¶ä¸å¤šï¼Œç»“åˆåˆ·æ–°çŒœæµ‹åº”è¯¥å°±æ˜¯å®ƒå•¦</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">const CGFloat MJRefreshHeaderHeight = 54.0;</div></pre></td></tr></table></figure>
<p>æ‰€ä»¥æ¨æµ‹ï¼ŒDZNEmptyDataSetViewæ˜¯æ ¹æ®æ­£åœ¨åˆ·æ–°çš„è¿‡ç¨‹ä¸­ç»™å…¶å®šå¸ƒå±€çš„ã€‚ç„¶è€Œæˆ‘ä»¬éœ€è¦é˜»æ­¢å®ƒæˆ–å»¶åå®ƒã€‚</p>
<blockquote>
<p>æ­¤å¤„æˆ‘æ˜¯æƒ³ç€åœ¨è¿™ä¹‹åç›´æ¥å¤„ç†å®ƒ,æ”¹å˜å®ƒçš„ originã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">for (UIView *subView in self.tableView.subviews) &#123;</div><div class="line">if ([NSStringFromClass([subView class]) isEqualToString:@&quot;DZNEmptyDataSetView&quot;])&#123;</div><div class="line">if (subView.frame.origin.y == 0) return;</div><div class="line">subView.frame = CGRectMake(0, 0, [UIScreen mainScreen].bounds.size.width, [UIScreen mainScreen].bounds.size.height - 64);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨åˆ·æ–°åè¿™æ ·å¤„ç†ï¼Œæ–¹æ³•æœ‰ç‚¹æ­»ï¼Œä½†æ˜¯ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç›´æ¥çš„ã€‚</p>
</blockquote>
<p>ä» github ä¸Šçœ‹åˆ°çš„æ–¹æ³•å¦‚ä¸‹ï¼Œè²Œä¼¼æ˜¯ç›®å‰ä½¿ç”¨æœ€åˆç†çš„å§ï¼Œæœ‰å…¶ä»–æ–¹æ³•æ¬¢è¿å‘ŠçŸ¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (void)emptyDataSetWillAppear:(UIScrollView *)scrollView &#123;</div><div class="line">scrollView.contentOffset = CGPointZero;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="www.wangsen.website/posts/45195/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹æ£®">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹æ£®åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/posts/45195/" itemprop="url">
                  å¦‚ä½•ä½¿ç”¨iOS 9çš„Core Spotlightæ¡†æ¶
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-05-25T15:47:01+08:00">
                2017-05-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/posts/45195/" class="leancloud_visitors" data-flag-title="å¦‚ä½•ä½¿ç”¨iOS 9çš„Core Spotlightæ¡†æ¶">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>iOSæ¯ä¸€æ¬¡ç‰ˆæœ¬çš„æ›´æ–°ï¼Œéƒ½ä¼šç»™å…¨çƒçš„å¼€å‘å·¥ä½œè€…å¸¦æ¥æ–°çš„â€œçŸ¥è¯†ç‚¹â€å’Œå¯¹ç°æœ‰æŠ€æœ¯è¿›è¡Œçš„æ”¹è¿›ã€‚æ˜¾ç„¶ï¼ŒiOSçš„æœ€æ–°ç‰ˆæœ¬iOS 9ä¸ä»…å»¶ç»­äº†è¿™ä¸€ä¼ ç»Ÿï¼Œè¿˜å…¬å¸ƒäº†æ–°çš„æ¡†æ¶å’ŒAPIï¼Œå¼€å‘è€…å¯ä½¿ç”¨æ–°å¢çš„æ¡†æ¶å’ŒAPIè®©è‡ªå·±çš„åº”ç”¨è¡¨ç°çš„æ›´å‡ºè‰²ã€‚å…¶ä¸­ä¹‹ä¸€å°±æ˜¯Core Spotlightæ¡†æ¶ï¼Œå®ƒåŒ…å«äº†ä¸€äº›ä¼˜ç§€çš„APIï¼Œæœ‰å¾…å¼€å‘è€…æ·±å…¥æ¢ç©¶ã€‚</p><br> <p>Core Spotlight (CS) æ¡†æ¶æ˜¯Search APIçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¢åŠ äº†å¼€å‘è€…çš„åº”ç”¨çš„æ›å…‰ç‡ï¼Œä½¿ç”¨æˆ·æ›´å®¹æ˜“å‘ç°å’Œè®¿é—®APPï¼Œä½†æ˜¯è¿™äº›APIåœ¨iOS9ä¹‹å‰çš„ç‰ˆæœ¬ä¸­æ˜¯ä¸å¯ç”¨çš„ã€‚è¿™äº›Search APIæ‹‰è¿‘äº†ç”¨æˆ·å’Œappçš„è·ç¦»ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¿™ç§æ–°çš„æ–¹æ³•è¿…é€Ÿçš„æ‰¾åˆ°app,è€Œappä¹Ÿå¯ä»¥è¿…é€Ÿçš„å¯¹ç”¨æˆ·çš„æ“ä½œåšå‡ºååº”ã€‚é™¤äº†Core Spotlightä¹‹å¤–ï¼ŒiOS 9è¿˜åŒ…å«ä»¥ä¸‹æ–°çš„searchåŠŸèƒ½ï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼š</p><br> <p>1ã€NSUserActivityè¿™ä¸ªç±»ä¸­æ–°çš„æ–¹æ³•å’Œå±æ€§ï¼ˆè¯¥ç±»è´Ÿè´£å­˜å‚¨appå…³é—­æ—¶çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¹‹åæ¢å¤appçš„çŠ¶æ€ã€‚ï¼‰</p><br> <p>2ã€åœ¨è®¾å¤‡ä¸Šä½¿ç”¨webæ ‡è®°ï¼Œä»¥ä¾¿æœç´¢åˆ°webä¸­çš„å†…å®¹ã€‚</p><br> <p>3ã€èƒ½é€šè¿‡webå†…å®¹ä¸­çš„é“¾æ¥ç›´æ¥å¯åŠ¨åº”ç”¨ç¨‹åºçš„é€šç”¨é“¾æ¥ã€‚</p><br> <p>æœ¬æ–‡ä¸ä¼šå¯¹ä»¥ä¸Šä¸‰ç‚¹åšè¯¦ç»†ä»‹ç»ï¼Œåªè¯¦ç»†è®²è§£Core Spotlightæ¡†æ¶ã€‚åœ¨è®²è§£ä¹‹å‰ï¼Œå…ˆäº†è§£ä»¥ä¸‹Core Spotlightåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</p><br> <p> <img src="http://img1.tuicool.com/Fzyymi.png!web" class="alignCenter" /> </p><br> <p> å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š <a href="https://developer.apple.com/library/ios/documentation/CoreSpotlight/Reference/CoreSpotlight_Framework/" target="_blank" rel="nofollow,noindex">Core Spotlingæ¡†æ¶</a> å¯ä»¥è®©ç”¨æˆ·é€šè¿‡Spotlightæœç´¢åˆ°appä¸­çš„æ•°æ®ï¼Œå¹¶å°†appç›¸å…³å†…å®¹å’Œç³»ç»Ÿæœç´¢è¿”å›çš„ç»“æœä¸€èµ·å±•ç¤ºå‡ºæ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·å¯ä»¥ä¸åº”ç”¨ç¨‹åºçš„å…¶ä»–ç›¸å…³ç»“æœè¿›è¡Œäº¤äº’ï¼Œå½“ç‚¹å‡»å…¶ä¸­ä¸€é¡¹æœç´¢ç»“æœæ—¶å¹¶ä¸ä»…ä»…è‡ªåŠ¨å¯åŠ¨APPï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥è®©ç”¨æˆ·é€‰æ‹©ä¸æ•°æ®æœ€ç›¸å…³çš„å†…å®¹ã€‚ </p><br> <p>ä»å¼€å‘è€…çš„è§’åº¦æ¥è¯´ï¼Œé›†æˆCore Spotlightæ¡†æ¶å¹¶ä½¿ç”¨å®ƒæä¾›çš„APIå¹¶ä¸æ˜¯ä¸€ä»¶éš¾äº‹ã€‚å­¦è¿‡è¿™æ•™ç¨‹ä¹‹åï¼Œä½ å°†ä¼šå‘ç°ä»…ä»…éœ€è¦å‡ è¡Œä»£ç å°±å¯ä»¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚é›†æˆçš„æ ¸å¿ƒé—®é¢˜åœ¨äºå¼€å‘è€…å¿…é¡»æŠŠAPPçš„æ•°æ®ä»¥ç‰¹å®šçš„æ ¼å¼åŠ å…¥åˆ°iOSç³»ç»Ÿçš„ç´¢å¼•ä¸­ã€‚</p><br> <p>ç”±äºæœ¬æ•™ç¨‹ä¸“æ³¨äºCore Spotlightæ¡†æ¶çš„ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä¸æ‰“ç®—æ·±å…¥ç ”ç©¶è¿™ä¸ªæ¡†æ¶ã€‚</p><br> <p>å…³äºDemo App</p><br> <p>å’Œå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬æ‰“ç®—é€šè¿‡ä¸€ä¸ªç¤ºä¾‹åº”ç”¨æ¥ç ”ç©¶æ¢ç´¢Spotlightçš„ç»†èŠ‚ã€‚åœ¨è¿™ä¸ªdemoä¸­ï¼Œæˆ‘ä»¬å°†å¾€åº”ç”¨ç¨‹åºä¸­å†™å…¥ä¸€ç»„æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®éƒ½æ˜¯å¯ä»¥é€šè¿‡çœŸæœºæˆ–æ¨¡æ‹Ÿå™¨çš„SpotlightåŠŸèƒ½è¢«æœç´¢åˆ°çš„ã€‚è™½ç„¶å®ç°SpotlightåŠŸèƒ½æœç´¢æ˜¯é‡ç‚¹,ä½†æ˜¯è¿˜æ˜¯æœ‰å¿…è¦ä»‹ç»ä¸€ä¸‹å…³äºdemo app çš„æ›´å¤šç»†èŠ‚ã€‚</p><br> <p>æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨è¦è¾¾åˆ°çš„æ•ˆæœæ˜¯å±•ç¤ºä¸€äº›ç”µå½±åŠå…¶ç›¸å…³çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç”µå½±æ¦‚è¦ã€å¯¼æ¼”ã€æ˜æ˜Ÿä»¥åŠå½±è¯„ç­‰çº§ç­‰ã€‚æ‰€æœ‰çš„ç”µå½±æ•°æ®å°†ä¼šæ”¾åœ¨åˆ—è¡¨ä¸­å±•ç¤ºï¼Œå¹¶ä¸”å½“ç‚¹å‡»åˆ°å¯¹åº”çš„è¡Œæ—¶ï¼Œæ‰€é€‰æ‹©çš„ç”µå½±ä¼šåœ¨ä¸€ä¸ªæ–°çš„è§†å›¾æ§åˆ¶å™¨ä¸­å±•ç¤ºå‡ºç”µå½±çš„è¯¦æƒ…ã€‚è¿™äº›åŠŸèƒ½å’Œæ•°æ®ä½œä¸ºæˆ‘ä»¬æŒ–æ˜Spotlightçš„APIè€Œè¨€å·²ç»å¤Ÿç”¨äº†ã€‚æˆ‘ä»¬çš„æ•°æ®æ¥æºæ˜¯International Movie Database (IMDB)ï¼Œæˆ‘ä»¬ä»è¿™ä¸ªç½‘ç«™è·å¾—æ•°æ®ç¤ºä¾‹ã€‚</p><br> <p>é€šè¿‡çœ‹ä¸‹é¢çš„åŠ¨ç”»ç¤ºä¾‹ï¼Œä½ å¯ä»¥å…ˆçœ‹ä¸€ä¸‹æ¼”ç¤ºç¨‹åºçš„æ•ˆæœï¼š</p><br> <p> <img src="http://img1.tuicool.com/mmy2uaE.gif" class="alignCenter" /> </p><br> <p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªç›®çš„ï¼šæœ€é‡è¦çš„æ˜¯è®©è¿™ä¸ªåº”ç”¨å†…çš„æ‰€æœ‰ç”µå½±æ–¹é¢çš„æ•°æ®éƒ½å¯ä»¥è¢«Spotlightæœç´¢åˆ°ã€‚å½“ç”¨æˆ·é€šè¿‡å…³é”®å­—æœç´¢æ—¶ï¼Œåº”ç”¨ç¨‹åºå†…å…³äºç”µå½±çš„æ•°æ®å°†ä¼šå±•ç°ç»™ç”¨æˆ·ã€‚è®¾ç½®è¿™äº›å…³é”®å­—æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥å·¥ä½œçš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¿…é¡»é‡æ–°å®šä¹‰å®ƒä»¬ï¼Œä½¿ä¹‹ç¬¦åˆè§„åˆ™ã€‚</p><br> <p>ç‚¹å‡»æœç´¢ç»“æœä¼šæ‰“å¼€åº”ç”¨ç¨‹åºï¼Œä¹‹åæˆ‘ä»¬è¦å®ç°ç¬¬äºŒä¸ªç›®æ ‡ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰åšä»»ä½•çš„å¤„ç†ï¼Œé‚£ä¹ˆå°†ä¼šåŠ è½½åŒ…å«æœ‰ç”µå½±æ•°æ®åˆ—è¡¨çš„é»˜è®¤è§†å›¾æ§åˆ¶å™¨å±•ç¤ºç»™ç”¨æˆ·ã€‚ç„¶è€Œï¼Œå‡å¦‚æˆ‘ä»¬è€ƒè™‘åˆ°ç”¨æˆ·ä½“éªŒçš„è¯ï¼Œè¿™ä¹ˆå¤„ç†å¹¶ä¸æ˜¯å¾ˆå¥½ã€‚å¥½çš„æ–¹æ¡ˆæ˜¯ï¼Œæˆ‘ä»¬çš„APPåº”è¯¥å±•ç¤ºSpotlighté€‰ä¸­çš„ç”µå½±çš„è¯¦æƒ…ã€‚ç®€è¨€ä¹‹ï¼Œæˆ‘ä»¬ä¸ä»…è¦è®©åº”ç”¨ç¨‹åºå†…çš„ç”µå½±æ•°æ®èƒ½å¤Ÿé€šè¿‡Spotlightè¢«æœç´¢åˆ°ï¼Œè€Œä¸”è¿˜è¦åœ¨ç”¨æˆ·ç‚¹å‡»æœç´¢ç»“æœæ—¶ï¼Œå±•ç¤ºå…³è”çš„ç”µå½±è¯¦æƒ…é¡µã€‚æ¥ä¸‹æ¥çš„ç¤ºä¾‹åŠ¨ç”»ä¼šè®²è§£çš„æ›´æ¸…æ¥šï¼š</p><br> <p> <img src="http://img2.tuicool.com/QfIBb23.gif" class="alignCenter" /> </p><br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/45195/#more" rel="contents">
              é˜…è¯»å…¨æ–‡ &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="www.wangsen.website/posts/59559/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹æ£®">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹æ£®åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/posts/59559/" itemprop="url">
                  è‡ªå·±åŠ¨æ‰‹å®ç°KVO
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-05-18T12:09:57+08:00">
                2017-05-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/posts/59559/" class="leancloud_visitors" data-flag-title="è‡ªå·±åŠ¨æ‰‹å®ç°KVO">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>æœ¬ç¯‡ä¼šæ¢ç©¶ KVO (Key-Value Observing) å®ç°æœºåˆ¶ï¼Œå¹¶å»å®è·µä¸€ç•ª - åˆ©ç”¨ Runtime è‡ªå·±åŠ¨æ‰‹å»å®ç° KVO ã€‚</p>

<h2 id="kvokeyvalueobserving">KVO (Key-Value Observing)</h2>

<p>KVO æ˜¯ Objective-C å¯¹è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰çš„å®ç°ã€‚ä¹Ÿæ˜¯ Cocoa Binding çš„åŸºç¡€ã€‚å½“è¢«è§‚å¯Ÿå¯¹è±¡çš„æŸä¸ªå±æ€§å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œè§‚å¯Ÿè€…å¯¹è±¡ä¼šè·å¾—é€šçŸ¥ã€‚</p>

<p>æœ‰æ„æ€çš„æ˜¯ï¼Œä½ ä¸éœ€è¦ç»™è¢«è§‚å¯Ÿçš„å¯¹è±¡æ·»åŠ ä»»ä½•é¢å¤–ä»£ç ï¼Œå°±èƒ½ä½¿ç”¨ KVO ã€‚è¿™æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿ</p>

<h2 id="kvo">KVO å®ç°æœºåˆ¶</h2>

<p>KVO çš„å®ç°ä¹Ÿä¾èµ–äº Objective-C å¼ºå¤§çš„ Runtime ã€‚Apple çš„æ–‡æ¡£æœ‰ç®€å•æåˆ°è¿‡ KVO çš„<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/KeyValueObserving/Articles/KVOImplementation.html">å®ç°</a>ï¼š</p>

<blockquote><br>  <p>Automatic key-value observing is implemented using a technique called isa-swizzlingâ€¦ When an observer is registered for an attribute of an object the isa pointer of the observed object is modified, pointing to an intermediate class rather than at the true class â€¦</p><br></blockquote>

<p>Apple çš„æ–‡æ¡£çœŸæ˜¯ä¸€ç¬”å¸¦è¿‡ï¼Œå”¯ä¸€æœ‰ç”¨çš„ä¿¡æ¯ä¹Ÿå°±æ˜¯ï¼šè¢«è§‚å¯Ÿå¯¹è±¡çš„ <code>isa</code> æŒ‡é’ˆä¼šæŒ‡å‘ä¸€ä¸ªä¸­é—´ç±»ï¼Œè€Œä¸æ˜¯åŸæ¥çœŸæ­£çš„ç±»ã€‚çœ‹æ¥ï¼ŒApple å¹¶ä¸å¸Œæœ›è¿‡å¤šæš´éœ² KVO çš„å®ç°ç»†èŠ‚ã€‚ä¸è¿‡ï¼Œè¦æ˜¯ä½ ç”¨ runtime æä¾›çš„æ–¹æ³•å»æ·±å…¥æŒ–æ˜ï¼Œæ‰€æœ‰è¢«æ©ç›–çš„ç»†èŠ‚éƒ½ä¼šåŸå½¢æ¯•éœ²ã€‚Mike Ash æ—©åœ¨ 2009 å¹´å°±åšäº†è¿™ä¹ˆä¸ª<a href="https://www.mikeash.com/pyblog/friday-qa-2009-01-23.html">æ¢ç©¶</a>ã€‚</p>

<p>ç®€å•æ¦‚è¿°ä¸‹ KVO çš„å®ç°ï¼š</p>

<p>å½“ä½ è§‚å¯Ÿä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¸€ä¸ªæ–°çš„ç±»ä¼šåŠ¨æ€è¢«åˆ›å»ºã€‚è¿™ä¸ªç±»ç»§æ‰¿è‡ªè¯¥å¯¹è±¡çš„åŸæœ¬çš„ç±»ï¼Œå¹¶é‡å†™äº†è¢«è§‚å¯Ÿå±æ€§çš„ <code>setter</code> æ–¹æ³•ã€‚è‡ªç„¶ï¼Œé‡å†™çš„ <code>setter</code> æ–¹æ³•ä¼šè´Ÿè´£åœ¨è°ƒç”¨åŸ <code>setter</code> æ–¹æ³•ä¹‹å‰å’Œä¹‹åï¼Œé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿå¯¹è±¡å€¼çš„æ›´æ”¹ã€‚æœ€åæŠŠè¿™ä¸ªå¯¹è±¡çš„ <code>isa</code> æŒ‡é’ˆ ( <code>isa</code> æŒ‡é’ˆå‘Šè¯‰ Runtime ç³»ç»Ÿè¿™ä¸ªå¯¹è±¡çš„ç±»æ˜¯ä»€ä¹ˆ ) æŒ‡å‘è¿™ä¸ªæ–°åˆ›å»ºçš„å­ç±»ï¼Œå¯¹è±¡å°±ç¥å¥‡çš„å˜æˆäº†æ–°åˆ›å»ºçš„å­ç±»çš„å®ä¾‹ã€‚</p>

<p>åŸæ¥ï¼Œè¿™ä¸ªä¸­é—´ç±»ï¼Œç»§æ‰¿è‡ªåŸæœ¬çš„é‚£ä¸ªç±»ã€‚ä¸ä»…å¦‚æ­¤ï¼ŒApple è¿˜é‡å†™äº† <code>-class</code> æ–¹æ³•ï¼Œä¼å›¾æ¬ºéª—æˆ‘ä»¬è¿™ä¸ªç±»æ²¡æœ‰å˜ï¼Œå°±æ˜¯åŸæœ¬é‚£ä¸ªç±»ã€‚æ›´å…·ä½“çš„ä¿¡æ¯ï¼Œå»è·‘ä¸€ä¸‹ Mike Ash çš„é‚£ç¯‡æ–‡ç« é‡Œçš„ä»£ç å°±èƒ½æ˜ç™½ï¼Œè¿™é‡Œå°±ä¸å†é‡å¤ã€‚</p>

<h2 id="kvo">KVO ç¼ºé™·</h2>

<p>KVO å¾ˆå¼ºå¤§ï¼Œæ²¡é”™ã€‚çŸ¥é“å®ƒå†…éƒ¨å®ç°ï¼Œæˆ–è®¸èƒ½å¸®åŠ©æ›´å¥½åœ°ä½¿ç”¨å®ƒï¼Œæˆ–åœ¨å®ƒå‡ºé”™æ—¶æ›´æ–¹ä¾¿è°ƒè¯•ã€‚ä½†å®˜æ–¹å®ç°çš„ KVO æä¾›çš„ API å®åœ¨ä¸æ€ä¹ˆæ ·ã€‚</p>

<p>æ¯”å¦‚ï¼Œä½ åªèƒ½é€šè¿‡é‡å†™ <code>-observeValueForKeyPath:ofObject:change:context:</code> æ–¹æ³•æ¥è·å¾—é€šçŸ¥ã€‚æƒ³è¦æä¾›è‡ªå®šä¹‰çš„ <code>selector</code> ï¼Œä¸è¡Œï¼›æƒ³è¦ä¼ ä¸€ä¸ª <code>block</code> ï¼Œé—¨éƒ½æ²¡æœ‰ã€‚è€Œä¸”ä½ è¿˜è¦å¤„ç†çˆ¶ç±»çš„æƒ…å†µ - çˆ¶ç±»åŒæ ·ç›‘å¬åŒä¸€ä¸ªå¯¹è±¡çš„åŒä¸€ä¸ªå±æ€§ã€‚ä½†æœ‰æ—¶å€™ï¼Œä½ ä¸çŸ¥é“çˆ¶ç±»æ˜¯ä¸æ˜¯å¯¹è¿™ä¸ªæ¶ˆæ¯æœ‰å…´è¶£ã€‚è™½ç„¶ <code>context</code> è¿™ä¸ªå‚æ•°å°±æ˜¯å¹²è¿™ä¸ªçš„ï¼Œä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ - åœ¨ <code>-addObserver:forKeyPath:options:context:</code> ä¼ è¿›å»ä¸€ä¸ªçˆ¶ç±»ä¸çŸ¥é“çš„ <code>context</code>ã€‚ä½†æ€»è§‰å¾—æ¡†åœ¨è¿™ä¸ª API çš„è®¾è®¡ä¸‹ï¼Œä»£ç å†™çš„å¾ˆåˆ«æ‰­ã€‚è‡³å°‘è‡³å°‘ï¼Œä¹Ÿåº”è¯¥æ”¯æŒ <code>block</code> å§ã€‚</p>

<p>æœ‰ä¸å°‘äººéƒ½è§‰å¾—å®˜æ–¹ KVO ä¸å¥½ä½¿çš„ã€‚Mike Ash çš„ <a href="https://www.mikeash.com/pyblog/key-value-observing-done-right.html">Key-Value Observing Done Right</a>ï¼Œä»¥åŠè·å¾—ä¸å°‘åˆ†äº«è®¨è®ºçš„ <a href="http://khanlou.com/2013/12/kvo-considered-harmful/">KVO Considered Harmful</a> éƒ½æŠŠ KVO æ‹¿å‡ºæ¥åŠæ‰“äº†ä¸€ç•ªã€‚æ‰€ä»¥åœ¨å®é™…å¼€å‘ä¸­ KVO ä½¿ç”¨çš„æƒ…æ™¯å¹¶ä¸å¤šï¼Œæ›´å¤šæ—¶å€™è¿˜æ˜¯ç”¨ Delegate æˆ– NotificationCenterã€‚</p>

<h2 id="kvo">è‡ªå·±å®ç° KVO</h2>

<p>å¦‚æœæ²¡æ‰¾åˆ°ç†æƒ³çš„ï¼Œå°±è‡ªå·±åŠ¨æ‰‹åšä¸€ä¸ªã€‚æ—¢ç„¶æˆ‘ä»¬å¯¹å®˜æ–¹çš„ API ä¸å¤ªæ»¡æ„ï¼ŒåˆçŸ¥é“å¦‚ä½•å»å®ç°ä¸€ä¸ª KVOï¼Œé‚£å°±å°è¯•è‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„ KVO ç©ç©ã€‚</p>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»º NSObject çš„ Categoryï¼Œå¹¶åœ¨å¤´æ–‡ä»¶ä¸­æ·»åŠ ä¸¤ä¸ª APIï¼š</p>

<pre><code>typedef void(^PGObservingBlock)(id observedObject, NSString *observedKey, id oldValue, id newValue);

@interface NSObject (KVO)

- (void)PG_addObserver:(NSObject *)observer
                forKey:(NSString *)key
             withBlock:(PGObservingBlock)block;

- (void)PG_removeObserver:(NSObject *)observer forKey:(NSString *)key;

@end
</code></pre>

<p>æ¥ä¸‹æ¥ï¼Œå®ç° <code>PG_addObserver:forKey:withBlock:</code> æ–¹æ³•ã€‚é€»è¾‘å¹¶ä¸å¤æ‚ï¼š</p>

<ol><br><li>æ£€æŸ¥å¯¹è±¡çš„ç±»æœ‰æ²¡æœ‰ç›¸åº”çš„ setter æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼›  </li><br><li>æ£€æŸ¥å¯¹è±¡ <code>isa</code> æŒ‡å‘çš„ç±»æ˜¯ä¸æ˜¯ä¸€ä¸ª KVO ç±»ã€‚å¦‚æœä¸æ˜¯ï¼Œæ–°å»ºä¸€ä¸ªç»§æ‰¿åŸæ¥ç±»çš„å­ç±»ï¼Œå¹¶æŠŠ <code>isa</code> æŒ‡å‘è¿™ä¸ªæ–°å»ºçš„å­ç±»ï¼›  </li><br><li>æ£€æŸ¥å¯¹è±¡çš„ KVO ç±»é‡å†™è¿‡æ²¡æœ‰è¿™ä¸ª setter æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰ï¼Œæ·»åŠ é‡å†™çš„ setter æ–¹æ³•ï¼›  </li><br><li>æ·»åŠ è¿™ä¸ªè§‚å¯Ÿè€…</li><br><br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/59559/#more" rel="contents">
              é˜…è¯»å…¨æ–‡ &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="www.wangsen.website/posts/47161/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹æ£®">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹æ£®åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/posts/47161/" itemprop="url">
                  iOSçº¿ç¨‹å®‰å…¨ç¯‡
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-05-17T15:52:14+08:00">
                2017-05-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/posts/47161/" class="leancloud_visitors" data-flag-title="iOSçº¿ç¨‹å®‰å…¨ç¯‡">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><strong>ä¸€ã€å‰è¨€</strong></span></p><p>å‰æ®µæ—¶é—´çœ‹äº†å‡ ä¸ªå¼€æºé¡¹ç›®ï¼Œå‘ç°ä»–ä»¬ä¿æŒçº¿ç¨‹åŒæ­¥çš„æ–¹å¼å„ä¸ç›¸åŒï¼Œæœ‰@synchronizedã€NSLockã€dispatch_semaphoreã€NSConditionã€pthread_mutexã€OSSpinLockã€‚åæ¥ç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹ï¼Œå‘ç°ä»–ä»¬çš„å®ç°æœºåˆ¶å„ä¸ç›¸åŒï¼Œæ€§èƒ½ä¹Ÿå„ä¸ä¸€æ ·ã€‚ä¸å¥½æ„æ€ï¼Œæˆ‘ä»¬å¹³å¸¸ä½¿ç”¨æœ€å¤šçš„@synchronizedæ˜¯æ€§èƒ½æœ€å·®çš„ã€‚ä¸‹é¢æˆ‘ä»¬å…ˆåˆ†åˆ«ä»‹ç»æ¯ä¸ªåŠ é”æ–¹å¼çš„ä½¿ç”¨ï¼Œåœ¨ä½¿ç”¨ä¸€ä¸ªæ¡ˆä¾‹æ¥å¯¹ä»–ä»¬è¿›è¡Œæ€§èƒ½å¯¹æ¯”ã€‚</p><p><span style="color: rgb(0, 176, 80);"><strong>äºŒã€ä»‹ç»ä¸ä½¿ç”¨</strong></span></p><p><strong>2.1ã€@synchronized</strong></p><pre class="brush:js;toolbar:false">NSObject&nbsp;<em>obj&nbsp;=&nbsp;[[NSObject&nbsp;alloc]&nbsp;init];<br>dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,&nbsp;0),&nbsp;^{<br>&nbsp;&nbsp;&nbsp;&nbsp;@synchronized(obj)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@â€éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1&nbsp;å¼€å§‹â€);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(3);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@â€éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1&nbsp;ç»“æŸâ€);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>});<br>dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,&nbsp;0),&nbsp;^{<br>&nbsp;&nbsp;&nbsp;&nbsp;sleep(1);<br>&nbsp;&nbsp;&nbsp;&nbsp;@synchronized(obj)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@â€éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2â€);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>});</pre><p>@synchronized(obj)æŒ‡ä»¤ä½¿ç”¨çš„objä¸ºè¯¥é”çš„å”¯ä¸€æ ‡è¯†ï¼Œåªæœ‰å½“æ ‡è¯†ç›¸åŒæ—¶ï¼Œæ‰ä¸ºæ»¡è¶³äº’æ–¥ï¼Œå¦‚æœçº¿ç¨‹2ä¸­çš„@synchronized(obj)æ”¹ä¸º@synchronized(self),åˆšçº¿ç¨‹2å°±ä¸ä¼šè¢«é˜»å¡ï¼Œ@synchronizedæŒ‡ä»¤å®ç°é”çš„ä¼˜ç‚¹å°±æ˜¯æˆ‘ä»¬ä¸éœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼çš„åˆ›å»ºé”å¯¹è±¡ï¼Œä¾¿å¯ä»¥å®ç°é”çš„æœºåˆ¶ï¼Œä½†ä½œä¸ºä¸€ç§é¢„é˜²æªæ–½ï¼Œ@synchronizedå—ä¼šéšå¼çš„æ·»åŠ ä¸€ä¸ªå¼‚å¸¸å¤„ç†ä¾‹ç¨‹æ¥ä¿æŠ¤ä»£ç ï¼Œè¯¥å¤„ç†ä¾‹ç¨‹ä¼šåœ¨å¼‚å¸¸æŠ›å‡ºçš„æ—¶å€™è‡ªåŠ¨çš„é‡Šæ”¾äº’æ–¥é”ã€‚æ‰€ä»¥å¦‚æœä¸æƒ³è®©éšå¼çš„å¼‚å¸¸å¤„ç†ä¾‹ç¨‹å¸¦æ¥é¢å¤–çš„å¼€é”€ï¼Œä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨é”å¯¹è±¡ã€‚</p><p>ä¸Šé¢ç»“æœçš„æ‰§è¡Œç»“æœä¸ºï¼š</p><pre class="brush:js;toolbar:false">2016-06-29&nbsp;20:48:35.747&nbsp;SafeMultiThread[35945:580107]&nbsp;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1&nbsp;å¼€å§‹<br>2016-06-29&nbsp;20:48:38.748&nbsp;SafeMultiThread[35945:580107]&nbsp;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1&nbsp;ç»“æŸ<br>2016-06-29&nbsp;20:48:38.749&nbsp;SafeMultiThread[35945:580118]&nbsp;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2</pre><p><strong>2.2ã€dispatch_semaphore</strong></p><pre class="brush:js;toolbar:false">dispatch_semaphore_t&nbsp;signal&nbsp;=&nbsp;dispatch_semaphore_create(1);<br>dispatch_time_t&nbsp;overTime&nbsp;=&nbsp;dispatch_time(DISPATCH_TIME_NOW,&nbsp;3&nbsp;</em>&nbsp;NSEC_PER_SEC);<br>dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,&nbsp;0),&nbsp;^{<br>&nbsp;&nbsp;&nbsp;&nbsp;dispatch_semaphore_wait(signal,&nbsp;overTime);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@â€éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1&nbsp;å¼€å§‹â€);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(2);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@â€éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1&nbsp;ç»“æŸâ€);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dispatch_semaphore_signal(signal);<br>});<br>dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,&nbsp;0),&nbsp;^{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(1);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dispatch_semaphore_wait(signal,&nbsp;overTime);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@â€éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2â€);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dispatch_semaphore_signal(signal);<br>});</pre><p>dispatch_semaphoreæ˜¯GCDç”¨æ¥åŒæ­¥çš„ä¸€ç§æ–¹å¼ï¼Œä¸ä»–ç›¸å…³çš„å…±æœ‰ä¸‰ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯dispatch_semaphore_createï¼Œdispatch_semaphore_signalï¼Œdispatch_semaphore_waitã€‚</p><p>ï¼ˆ1ï¼‰dispatch_semaphore_createçš„å£°æ˜ä¸ºï¼š</p><pre class="brush:js;toolbar:false">dispatch_semaphore_t&nbsp;dispatch_semaphore_create(long&nbsp;value);</pre><p>ä¼ å…¥çš„å‚æ•°ä¸ºlongï¼Œè¾“å‡ºä¸€ä¸ªdispatch_semaphore_tç±»å‹ä¸”å€¼ä¸ºvalueçš„ä¿¡å·é‡ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ä¼ å…¥çš„å‚æ•°valueå¿…é¡»å¤§äºæˆ–ç­‰äº0ï¼Œå¦åˆ™dispatch_semaphore_createä¼šè¿”å›NULLã€‚</p><p>ï¼ˆ2ï¼‰dispatch_semaphore_signalçš„å£°æ˜ä¸ºï¼š</p><pre class="brush:js;toolbar:false">long&nbsp;dispatch_semaphore_signal(dispatch_semaphore_t&nbsp;dsema);</pre><p>è¿™ä¸ªå‡½æ•°ä¼šä½¿ä¼ å…¥çš„ä¿¡å·é‡dsemaçš„å€¼åŠ 1ï¼›</p><p>(3) dispatch_semaphore_waitçš„å£°æ˜ä¸ºï¼š</p><pre class="brush:js;toolbar:false">long&nbsp;dispatch_semaphore_wait(dispatch_semaphore_t&nbsp;dsema,&nbsp;dispatch_time_t&nbsp;timeout);</pre><p>è¿™ä¸ªå‡½æ•°ä¼šä½¿ä¼ å…¥çš„ä¿¡å·é‡dsemaçš„å€¼å‡1ï¼›è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯è¿™æ ·çš„ï¼Œå¦‚æœdsemaä¿¡å·é‡çš„å€¼å¤§äº0ï¼Œè¯¥å‡½æ•°æ‰€å¤„çº¿ç¨‹å°±ç»§ç»­æ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼Œå¹¶ä¸”å°†ä¿¡å·é‡çš„å€¼å‡1ï¼›å¦‚æœdesemaçš„å€¼ä¸º0ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±é˜»å¡å½“å‰çº¿ç¨‹ç­‰å¾…timeoutï¼ˆæ³¨æ„timeoutçš„ç±»å‹ä¸ºdispatch_time_tï¼Œä¸èƒ½ç›´æ¥ä¼ å…¥æ•´å½¢æˆ–floatå‹æ•°ï¼‰ï¼Œå¦‚æœç­‰å¾…çš„æœŸé—´desemaçš„å€¼è¢«dispatch_semaphore_signalå‡½æ•°åŠ 1äº†ï¼Œä¸”è¯¥å‡½æ•°ï¼ˆå³dispatch_semaphore_waitï¼‰æ‰€å¤„çº¿ç¨‹è·å¾—äº†ä¿¡å·é‡ï¼Œé‚£ä¹ˆå°±ç»§ç»­å‘ä¸‹æ‰§è¡Œå¹¶å°†ä¿¡å·é‡å‡1ã€‚å¦‚æœç­‰å¾…æœŸé—´æ²¡æœ‰è·å–åˆ°ä¿¡å·é‡æˆ–è€…ä¿¡å·é‡çš„å€¼ä¸€ç›´ä¸º0ï¼Œé‚£ä¹ˆç­‰åˆ°timeoutæ—¶ï¼Œå…¶æ‰€å¤„çº¿ç¨‹è‡ªåŠ¨æ‰§è¡Œå…¶åè¯­å¥ã€‚</p><p>dispatch_semaphore æ˜¯ä¿¡å·é‡ï¼Œä½†å½“ä¿¡å·æ€»é‡è®¾ä¸º 1 æ—¶ä¹Ÿå¯ä»¥å½“ä½œé”æ¥ã€‚åœ¨æ²¡æœ‰ç­‰å¾…æƒ…å†µå‡ºç°æ—¶ï¼Œå®ƒçš„æ€§èƒ½æ¯” pthread_mutex è¿˜è¦é«˜ï¼Œä½†ä¸€æ—¦æœ‰ç­‰å¾…æƒ…å†µå‡ºç°æ—¶ï¼Œæ€§èƒ½å°±ä¼šä¸‹é™è®¸å¤šã€‚ç›¸å¯¹äº OSSpinLock æ¥è¯´ï¼Œå®ƒçš„ä¼˜åŠ¿åœ¨äºç­‰å¾…æ—¶ä¸ä¼šæ¶ˆè€— CPU èµ„æºã€‚</p><p>å¦‚ä¸Šçš„ä»£ç ï¼Œå¦‚æœè¶…æ—¶æ—¶é—´overTimeè®¾ç½®æˆ&gt;2ï¼Œå¯å®ŒæˆåŒæ­¥æ“ä½œã€‚å¦‚æœoverTime<2çš„è¯ï¼Œåœ¨çº¿ç¨‹1è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆçš„æƒ…å†µä¸‹ï¼Œæ­¤æ—¶è¶…æ—¶äº†ï¼Œå°†è‡ªåŠ¨æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚</p><p>ä¸Šé¢ä»£ç çš„æ‰§è¡Œç»“æœä¸ºï¼š</p><pre class="brush:js;toolbar:false">2016-06-29&nbsp;20:47:52.324&nbsp;SafeMultiThread[35945:579032]&nbsp;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1&nbsp;å¼€å§‹<br>2016-06-29&nbsp;20:47:55.325&nbsp;SafeMultiThread[35945:579032]&nbsp;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1&nbsp;ç»“æŸ<br>2016-06-29&nbsp;20:47:55.326&nbsp;SafeMultiThread[35945:579033]&nbsp;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2</pre><p>å¦‚æœæŠŠè¶…æ—¶æ—¶é—´è®¾ç½®ä¸º<2sçš„æ—¶å€™ï¼Œæ‰§è¡Œçš„ç»“æœå°±æ˜¯ï¼š</p><pre class="brush:js;toolbar:false">2016-06-30&nbsp;18:53:24.049&nbsp;SafeMultiThread[30834:434334]&nbsp;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1&nbsp;å¼€å§‹<br>2016-06-30&nbsp;18:53:25.554&nbsp;SafeMultiThread[30834:434332]&nbsp;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2<br>2016-06-30&nbsp;18:53:26.054&nbsp;SafeMultiThread[30834:434334]&nbsp;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1&nbsp;ç»“æŸ</pre><p><strong>2.3ã€NSLock</strong></p><pre class="brush:js;toolbar:false">NSLock&nbsp;<em>lock&nbsp;=&nbsp;[[NSLock&nbsp;alloc]&nbsp;init];<br>dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,&nbsp;0),&nbsp;^{<br>&nbsp;&nbsp;&nbsp;&nbsp;//[lock&nbsp;lock];<br>&nbsp;&nbsp;&nbsp;&nbsp;[lock&nbsp;lockBeforeDate:[NSDate&nbsp;date]];<br>&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@â€éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1&nbsp;å¼€å§‹â€);<br>&nbsp;&nbsp;&nbsp;&nbsp;sleep(2);<br>&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@â€éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1&nbsp;ç»“æŸâ€);<br>&nbsp;&nbsp;&nbsp;&nbsp;[lock&nbsp;unlock];<br>});<br>dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,&nbsp;0),&nbsp;^{<br>&nbsp;&nbsp;&nbsp;&nbsp;sleep(1);<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;([lock&nbsp;tryLock])&nbsp;{//å°è¯•è·å–é”ï¼Œå¦‚æœè·å–ä¸åˆ°è¿”å›NOï¼Œä¸ä¼šé˜»å¡è¯¥çº¿ç¨‹<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@â€é”å¯ç”¨çš„æ“ä½œâ€);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[lock&nbsp;unlock];<br>&nbsp;&nbsp;&nbsp;&nbsp;}else{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@â€é”ä¸å¯ç”¨çš„æ“ä½œâ€);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;NSDate&nbsp;</em>date&nbsp;=&nbsp;[[NSDate&nbsp;alloc]&nbsp;initWithTimeIntervalSinceNow:3];<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;([lock&nbsp;lockBeforeDate:date])&nbsp;{//å°è¯•åœ¨æœªæ¥çš„3så†…è·å–é”ï¼Œå¹¶é˜»å¡è¯¥çº¿ç¨‹ï¼Œå¦‚æœ3så†…è·å–ä¸åˆ°æ¢å¤çº¿ç¨‹,&nbsp;è¿”å›NO,ä¸ä¼šé˜»å¡è¯¥çº¿ç¨‹<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@â€æ²¡æœ‰è¶…æ—¶ï¼Œè·å¾—é”â€);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[lock&nbsp;unlock];<br>&nbsp;&nbsp;&nbsp;&nbsp;}else{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@â€è¶…æ—¶ï¼Œæ²¡æœ‰è·å¾—é”â€);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>});</pre><p>NSLockæ˜¯Cocoaæä¾›ç»™æˆ‘ä»¬æœ€åŸºæœ¬çš„é”å¯¹è±¡ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç»å¸¸æ‰€ä½¿ç”¨çš„ï¼Œé™¤lockå’Œunlockæ–¹æ³•å¤–ï¼ŒNSLockè¿˜æä¾›äº†tryLockå’ŒlockBeforeDate:ä¸¤ä¸ªæ–¹æ³•ï¼Œå‰ä¸€ä¸ªæ–¹æ³•ä¼šå°è¯•åŠ é”ï¼Œå¦‚æœé”ä¸å¯ç”¨(å·²ç»è¢«é”ä½)ï¼Œåˆšå¹¶ä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œå¹¶è¿”å›NOã€‚lockBeforeDate:æ–¹æ³•ä¼šåœ¨æ‰€æŒ‡å®šDateä¹‹å‰å°è¯•åŠ é”ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰éƒ½ä¸èƒ½åŠ é”ï¼Œåˆ™è¿”å›NOã€‚</p><p>ä¸Šé¢ä»£ç çš„æ‰§è¡Œç»“æœä¸ºï¼š</p><pre class="brush:js;toolbar:false">2016-06-29&nbsp;20:45:08.864&nbsp;SafeMultiThread[35911:575795]&nbsp;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1&nbsp;å¼€å§‹<br>2016-06-29&nbsp;20:45:09.869&nbsp;SafeMultiThread[35911:575781]&nbsp;é”ä¸å¯ç”¨çš„æ“ä½œ<br>2016-06-29&nbsp;20:45:10.869&nbsp;SafeMultiThread[35911:575795]&nbsp;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1&nbsp;ç»“æŸ<br>2016-06-29&nbsp;20:45:10.870&nbsp;SafeMultiThread[35911:575781]&nbsp;æ²¡æœ‰è¶…æ—¶ï¼Œè·å¾—é”</pre><p>æºç å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="brush:js;toolbar:false">@protocol&nbsp;NSLocking<br>-&nbsp;(void)lock;<br>-&nbsp;(void)unlock;<br>@end<br>@interface&nbsp;NSLock&nbsp;:&nbsp;NSObject&nbsp;&nbsp;{<br>@private<br>&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;<em>_priv;<br>}<br>-&nbsp;(BOOL)tryLock;<br>-&nbsp;(BOOL)lockBeforeDate:(NSDate&nbsp;</em>)limit;<br>@property&nbsp;(nullable,&nbsp;copy)&nbsp;NSString&nbsp;<em>name&nbsp;NS_AVAILABLE(10_5,&nbsp;2_0);<br>@end</pre><p><strong>2.4ã€NSRecursiveLocké€’å½’é”</strong></p><pre class="brush:js;toolbar:false">//NSLock&nbsp;</em>lock&nbsp;=&nbsp;[[NSLock&nbsp;alloc]&nbsp;init];<br>NSRecursiveLock&nbsp;*lock&nbsp;=&nbsp;[[NSRecursiveLock&nbsp;alloc]&nbsp;init];<br>dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,&nbsp;0),&nbsp;^{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;void&nbsp;(^RecursiveMethod)(int);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RecursiveMethod&nbsp;=&nbsp;^(int&nbsp;value)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[lock&nbsp;lock];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value&nbsp;&gt;&nbsp;0)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@â€value&nbsp;=&nbsp;%dâ€,&nbsp;value);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep(1);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RecursiveMethod(value&nbsp;-&nbsp;1);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[lock&nbsp;unlock];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RecursiveMethod(5);<br>});</pre><br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/47161/#more" rel="contents">
              é˜…è¯»å…¨æ–‡ &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="www.wangsen.website/posts/13633/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹æ£®">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹æ£®åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/posts/13633/" itemprop="url">
                  Objective-C Runtime 1å°æ—¶å…¥é—¨æ•™ç¨‹
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-05-15T17:28:25+08:00">
                2017-05-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/posts/13633/" class="leancloud_visitors" data-flag-title="Objective-C Runtime 1å°æ—¶å…¥é—¨æ•™ç¨‹">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><h1>ä¸€ã€å‰è¨€ï¼š</h1></p>
<p>å¦‚æœä½ æ²¡æœ‰Objective-CåŸºç¡€ï¼Œè¯·å­¦ä¹ äº†åŸºç¡€çš„iOSå¼€å‘å†æ¥ï¼Œè¿™ä¸ª1å°æ—¶æ˜¯ç»™æœ‰ä¸€å®šiOSåŸºç¡€çš„ç«¥é‹çš„ã€‚å¦‚æœä½ æ˜¯å¤§ç‰›æˆ–è€…ä½ æ„Ÿè§‰Objective-C Runtimeå¤ªç®€å•ä¸ç”¨1å°æ—¶å­¦ä¹ çš„ï¼Œä¹Ÿè¯·æ‚¨ç»•é“ï¼Œè¿™æˆ–è®¸åªæ˜¯æˆ‘çš„ç§äººç¬”è®°äº†ã€‚</p><br><p><font color="red">è¯·è·Ÿç€æ•™ç¨‹â€œä¸€æ­¥æ­¥æ¥â€ï¼Œè¯·ä¸è¦å¤§æ¦‚åœ°æ‰«ä¸¤çœ¼å°±è¯´çœ‹ä¸æ‡‚â€”â€”ä»¥è¿™ç§æ€åº¦å†™æˆä»€ä¹ˆæ ·ä½ ä¹Ÿçœ‹ä¸æ‡‚ã€‚è¿™æ˜¯<b>1å°æ—¶å…¥é—¨æ•™ç¨‹ï¼Œè¯·ä¸è¦è¯•å›¾åœ¨1åˆ†é’Ÿå†…å…¥é—¨ï¼</font></p><br><h1>äºŒã€æœ¬æ–‡ç›®æ ‡ï¼š</h1><br><p>1å°æ—¶è®©ä½ çŸ¥é“ä»€ä¹ˆæ˜¯Objective-C Runtimeï¼Œå¹¶å¯¹å®ƒæœ‰ä¸€å®šçš„åŸºæœ¬äº†è§£ï¼Œå¯ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­è¿ç”¨è‡ªå¦‚ã€‚</p><br><h1>ä¸‰ã€Objective-C Runtimeåˆ°åº•æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ</h1><br><p>ç®€è€Œè¨€ä¹‹ï¼ŒObjective-C Runtimeæ˜¯ä¸€ä¸ªå°†Cè¯­è¨€è½¬åŒ–ä¸ºé¢å‘å¯¹è±¡è¯­è¨€çš„æ‰©å±•ã€‚<br /><br>æˆ‘ä»¬å°†C++å’ŒObjectiveè¿›è¡Œå¯¹æ¯”ï¼Œè™½ç„¶C++å’ŒObjective-Céƒ½æ˜¯åœ¨Cçš„åŸºç¡€ä¸ŠåŠ å…¥é¢å‘å¯¹è±¡çš„ç‰¹æ€§æ‰©å……è€Œæˆçš„ç¨‹åºè®¾è®¡è¯­è¨€ï¼Œä½†äºŒè€…å®ç°çš„æœºåˆ¶å·®å¼‚å¾ˆå¤§ã€‚C++æ˜¯åŸºäºé™æ€ç±»å‹ï¼Œè€ŒObjective-Cæ˜¯åŸºäºåŠ¨æ€è¿è¡Œæ—¶ç±»å‹ã€‚<s>ä¹Ÿå°±æ˜¯è¯´ç”¨C++ç¼–å†™çš„ç¨‹åºç¼–è¯‘æ—¶å°±ç›´æ¥ç¼–è¯‘æˆäº†å¯ä»¤æœºå™¨è¯»æ‡‚çš„æœºå™¨è¯­è¨€ï¼›ç”¨Objective-Cç¼–å†™çš„ç¨‹åºä¸èƒ½ç›´æ¥ç¼–è¯‘æˆå¯ä»¤æœºå™¨è¯»æ‡‚çš„æœºå™¨è¯­è¨€ï¼Œè€Œæ˜¯åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œé€šè¿‡RuntimeæŠŠç¨‹åºè½¬ä¸ºå¯ä»¤æœºå™¨è¯»æ‡‚çš„æœºå™¨è¯­è¨€ã€‚</s>ä¹Ÿå°±æ˜¯è¯´ç”¨C++ç¼–å†™çš„ç¨‹åºé€šè¿‡ç¼–è¯‘å™¨ç›´æ¥æŠŠå‡½æ•°åœ°å€ç¡¬ç¼–ç è¿›å…¥å¯æ‰§è¡Œæ–‡ä»¶ï¼›è€ŒObjective-Cæ— æ³•é€šè¿‡ç¼–è¯‘å™¨ç›´æ¥æŠŠå‡½æ•°åœ°å€ç¡¬ç¼–ç è¿›å…¥å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œåˆ©ç”¨Runtimeæ ¹æ®æ¡ä»¶åˆ¤æ–­ä½œå‡ºå†³å®šã€‚å‡½æ•°æ ‡è¯†ä¸å‡½æ•°è¿‡ç¨‹çš„çœŸæ­£å†…å®¹ä¹‹é—´çš„å…³è”å¯ä»¥åŠ¨æ€ä¿®æ”¹ã€‚Runtimeæ˜¯Objectiveä¸å¯ç¼ºå°‘çš„é‡è¦ä¸€éƒ¨åˆ†ã€‚</p><br><p>ä¼ é€é—¨-&gt;<a rel="external nofollow" href="https://github.com/ianisme/IANRuntimeStudy/tree/master/objc-runtime%E6%BA%90%E7%A0%81" target="_blank">runtimeæºç </a></p><br><h1>å››ã€Objective-Cçš„å…ƒç´ è®¤çŸ¥</h1><br><h2>4.1 idå’ŒClass</h2><br><p>æ‰“å¼€/Public Headers/objc.hæ–‡ä»¶å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å®šä¹‰ï¼š</p><br><pre><code>#if !OBJC_TYPES_DEFINED<br>/// An opaque type that represents an Objective-C class.<br>typedef struct objc_class <em>Class;<br><br>/// Represents an instance of a class.<br>struct objc_object {<br>Class isa  OBJC_ISA_AVAILABILITY;<br>};<br><br>/// A pointer to an instance of a class.<br>typedef struct objc_object </em>id;<br>#endif<br></code></pre><br><p>Classæ˜¯ä¸€ä¸ªæŒ‡å‘objc_classç»“æ„ä½“çš„æŒ‡é’ˆï¼Œè€Œidæ˜¯ä¸€ä¸ªæŒ‡å‘objc_objectç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå…¶ä¸­çš„isaæ˜¯ä¸€ä¸ªæŒ‡å‘objc_classç»“æ„ä½“çš„æŒ‡é’ˆã€‚å…¶ä¸­çš„idå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å¯¹è±¡ï¼ŒClasså°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ç±»ã€‚</p><br><p>æ‰“å¼€/Public Headers/runtime.hæ–‡ä»¶<br /><br>objc_classçš„å®šä¹‰å¦‚ä¸‹ï¼š</p><br><pre><code>typedef struct objc_class <em>Class;<br>struct objc_class {<br>Class isa                                 OBJC_ISA_AVAILABILITY; // metaclass<br>#if !<strong>OBJC2</strong><br>Class super_class                         OBJC2_UNAVAILABLE; // çˆ¶ç±»<br>const char </em>name                          OBJC2_UNAVAILABLE; // ç±»å<br>long version                              OBJC2_UNAVAILABLE; // ç±»çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œé»˜è®¤ä¸º0ï¼Œå¯ä»¥é€šè¿‡runtimeå‡½æ•°class_setVersionæˆ–è€…class_getVersionè¿›è¡Œä¿®æ”¹ã€è¯»å–<br>long info                                 OBJC2_UNAVAILABLE; // ç±»ä¿¡æ¯ï¼Œä¾›è¿è¡Œæ—¶æœŸä½¿ç”¨çš„ä¸€äº›ä½æ ‡è¯†ï¼Œå¦‚CLS_CLASS (0x1L) è¡¨ç¤ºè¯¥ç±»ä¸ºæ™®é€š classï¼Œå…¶ä¸­åŒ…å«å®ä¾‹æ–¹æ³•å’Œå˜é‡;CLS_META (0x2L) è¡¨ç¤ºè¯¥ç±»ä¸º metaclassï¼Œå…¶ä¸­åŒ…å«ç±»æ–¹æ³•;<br>long instance_size                        OBJC2_UNAVAILABLE; // è¯¥ç±»çš„å®ä¾‹å˜é‡å¤§å°ï¼ˆåŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å®ä¾‹å˜é‡ï¼‰<br>struct objc_ivar_list <em>ivars              OBJC2_UNAVAILABLE; // è¯¥ç±»çš„æˆå‘˜å˜é‡åœ°å€åˆ—è¡¨<br>struct objc_method_list **methodLists     OBJC2_UNAVAILABLE; // æ–¹æ³•åœ°å€åˆ—è¡¨ï¼Œä¸ info çš„ä¸€äº›æ ‡å¿—ä½æœ‰å…³ï¼Œå¦‚CLS_CLASS (0x1L)ï¼Œåˆ™å­˜å‚¨å®ä¾‹æ–¹æ³•ï¼Œå¦‚CLS_META (0x2L)ï¼Œåˆ™å­˜å‚¨ç±»æ–¹æ³•;<br>struct objc_cache </em>cache                  OBJC2_UNAVAILABLE; // ç¼“å­˜æœ€è¿‘ä½¿ç”¨çš„æ–¹æ³•åœ°å€ï¼Œç”¨äºæå‡æ•ˆç‡ï¼›<br>struct objc_protocol_list <em>protocols      OBJC2_UNAVAILABLE; // å­˜å‚¨è¯¥ç±»å£°æ˜éµå®ˆçš„åè®®çš„åˆ—è¡¨<br>#endif<br>}<br>/</em> Use <code>Class</code> instead of <code>struct objc_class *</code> <em>/<br></code></pre><br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/13633/#more" rel="contents">
              é˜…è¯»å…¨æ–‡ &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="www.wangsen.website/posts/28457/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹æ£®">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹æ£®åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/posts/28457/" itemprop="url">
                  Swiftä½¿ç”¨OCæ¡†æ¶
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-05-11T11:18:04+08:00">
                2017-05-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/posts/28457/" class="leancloud_visitors" data-flag-title="Swiftä½¿ç”¨OCæ¡†æ¶">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Swiftä½¿ç”¨OCæ¡†æ¶</p>
<h4 id="åœºæ™¯ä¸€ï¼šä½¿ç”¨Cocopodså¯¼å…¥æ¡†æ¶"><a href="#åœºæ™¯ä¸€ï¼šä½¿ç”¨Cocopodså¯¼å…¥æ¡†æ¶" class="headerlink" title="åœºæ™¯ä¸€ï¼šä½¿ç”¨Cocopodså¯¼å…¥æ¡†æ¶"></a>åœºæ™¯ä¸€ï¼šä½¿ç”¨Cocopodså¯¼å…¥æ¡†æ¶</h4><p>çœ‹ä»¥å‰çš„æ•™ç¨‹ç”¨Cocopodså¯¼å…¥æ¡†æ¶ä¹Ÿè¦æ‰‹åŠ¨è®¾ç½®æ¡¥æ¥æ–‡ä»¶ï¼Œæˆ‘æœ€è¿‘åˆ›å»ºçš„é¡¹ç›®ç”¨Cocopodså®‰è£…çš„<code>SDWebImage</code>å’Œ<code>SVProgressHUD</code>å‘ç°xcodeä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ¡¥æ¥çš„.hæ–‡ä»¶åå­—æ˜¯<code>Targets-Bridging-Header.h</code>,å¹¶ä¸”ä¼šè‡ªåŠ¨è®¾ç½®è·¯å¾„å¦‚å›¾ï¼Œè¿™ä¸ªç¨ååœ¨åœºæ™¯2å†ç»§ç»­ä»‹ç»<br><img src="http://upload-images.jianshu.io/upload_images/1177260-81dbb05fa1c972fc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image description"></p>
<p>ç”¨Cocopodså¯¼å…¥çš„OCæ¡†æ¶Xcodeä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ä½†æ˜¯æˆ‘å¹¶ä¸èƒ½åœ¨æœ¬åœ°æ‰¾åˆ°ä»–ï¼Œçœ‹SDWebImageçš„è¿™ä¸ªæ–‡ä»¶å¦‚ä¸‹<br><a href="http://photozou.jp/photo/show/3167534/247718546" target="_blank" rel="external"><img src="http://art13.photozou.jp/pub/534/3167534/photo/247718546.v1494470486.jpg" alt="SDWebImage" width="450" height="279"></a><br><br>åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ç›´æ¥ç”¨<code>import SDWebImage</code>å°±å¯ä»¥ä½¿ç”¨<code> SDWebImage</code>çš„å„ç§æ–¹æ³•äº†<br>è¿™ç§ç”±Cocopodså¯¼å…¥çš„æ¡†æ¶éƒ½ä¼šç”Ÿæˆè¿™ä¸ªç±»ä¼¼çš„æ–‡ä»¶ä¸ç”¨åœ¨æ¡¥æ¥æ–‡ä»¶æœ‰å¼•å…¥å¤´æ–‡ä»¶ç±»ä¼¼<code>#import â€œUIImageView+WebCache.hâ€</code>.</p>
<h4 id="åœºæ™¯äºŒï¼šæ²¡æœ‰ä½¿ç”¨Cocopodsæˆ–è€…ä½¿ç”¨Cocopodsæ‰‹åŠ¨å¯¼å…¥æ¡†æ¶"><a href="#åœºæ™¯äºŒï¼šæ²¡æœ‰ä½¿ç”¨Cocopodsæˆ–è€…ä½¿ç”¨Cocopodsæ‰‹åŠ¨å¯¼å…¥æ¡†æ¶" class="headerlink" title="åœºæ™¯äºŒï¼šæ²¡æœ‰ä½¿ç”¨Cocopodsæˆ–è€…ä½¿ç”¨Cocopodsæ‰‹åŠ¨å¯¼å…¥æ¡†æ¶"></a>åœºæ™¯äºŒï¼šæ²¡æœ‰ä½¿ç”¨Cocopodsæˆ–è€…ä½¿ç”¨Cocopodsæ‰‹åŠ¨å¯¼å…¥æ¡†æ¶</h4><p>æ²¡æœ‰ä½¿ç”¨Cocopodså°±éœ€è¦è‡ªå·±æ–°å»ºä¸€ä¸ªæ¡¥æ¥æ–‡ä»¶äº†å½“ç„¶å¦‚æœç”¨äº†Cocopodså¯ä»¥ä½¿ç”¨Xcodeè‡ªåŠ¨ç”Ÿæˆçš„å°±æ˜¯åœºæ™¯ä¸€çš„é‚£ç§æƒ…å†µäº†,ä¸‹å›¾æ–°å»ºä¸€ä¸ªæ¡¥æ¥æ–‡ä»¶å‘½åéšæ„è¿™é‡Œçš„å›¾æ˜¯ç”¨åˆ«äººçš„çœŸæ˜¯éšæ„äº†å•Šï¼Œæˆ‘å»ºè®®å‘½åè§„åˆ™å¯ä»¥æŒ‰ç…§<code>Targets-Bridging-Header.h</code>æ¯•ç«Ÿè¿™æ ·çœ‹èµ·æ¥æ­£è§„ç‚¹å˜›<br><img src="http://upload-images.jianshu.io/upload_images/1177260-f4d50e12169a4794.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image description"><br>å¡«å¥½æ–‡ä»¶åå­—,é€‰ä¸­è¯­è¨€ä¸ºObjective-C,ç‚¹å‡»Next</p>
<p>è¿™ä¸ªæ—¶å€™å›å‡ºç°ä¸€ä¸ªå¼¹æ¡†,æ„æ€å°±æ˜¯ ä½ æ˜¯å¦æƒ³è¦é…ç½®ä¸€ä¸ªOCæ¡¥æ¥æ–‡ä»¶,é€‰æ‹©åˆ›å»º<br><img src="http://upload-images.jianshu.io/upload_images/1177260-9cd0d85912e6e2d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image description">ï¼Œè·¯å¾„å¯ä»¥æŒ‰ç…§åœºæ™¯ä¸€çš„å›¾æ‰¾åˆ°å°±ä¸å†ä¸Šå›¾äº†ã€‚è¿™é‡Œå¼ºè°ƒä¸€ä¸ªé‡è¦è®¾ç½®<br><br>æ³¨æ„ã€æ³¨æ„ã€æ³¨æ„<br><br>é‡è¦çš„äº‹æƒ…è¯´ä¸‰éå˜›<br><br>1.é€‰æ‹©targetï¼ˆå°±æ˜¯å·¦è¾¹ä½ çš„å·¥ç¨‹targetï¼‰â€”â€” BuildSettings â€”â€” search Paths ä¸‹çš„ User Header Search Paths</p>
<p>2.åŒå‡»åé¢çš„ç©ºç™½åŒºåŸŸï¼Œå¹¶ä¸”ç‚¹å‡»â€œ+â€å·æ·»åŠ ä¸€é¡¹ï¼šå¹¶ä¸”è¾“å…¥ï¼šâ€œ$(PODS_ROOT)â€ï¼ˆæ²¡æœ‰å¼•å·ï¼‰ï¼Œé€‰æ‹©ï¼šrecursiveï¼ˆä¼šåœ¨ç›¸åº”çš„ç›®å½•é€’å½’æœç´¢æ–‡ä»¶ï¼‰ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1177260-a0874a70ce8d4722.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image description"><br><br><img src="http://upload-images.jianshu.io/upload_images/1177260-f069f467c1d2d028.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image description"><br><br>è¿™ä¸ªè®¾ç½®å®Œæ‰å¯ä»¥ä¿è¯åœ¨æ¡¥æ¥æ–‡ä»¶é‡Œèƒ½å¤Ÿæ­£å¸¸å¼•ç”¨OCåº“</p>
<p>ä¸€åˆ‡è®¾ç½®å¦¥å½“å°±å¯ä»¥æ‰‹åŠ¨æ‹–å…¥OCåº“äº†ï¼Œä¸¾ä¸ªä¾‹å­æˆ‘ç”¨çš„<code>Toast</code></p>
<p><img src="http://art13.photozou.jp/pub/534/3167534/photo/247718829.v1494471880.jpg" alt="ç‹æ£®åšå®¢ï¼ŒSwiftä½¿ç”¨OCæ¡†æ¶" width="450" height="218"><br></p>
<p><a href="http://photozou.jp/photo/show/3167534/247718892" target="_blank" rel="external"><img src="http://art13.photozou.jp/pub/534/3167534/photo/247718892.v1494472099.jpg" alt="10C510A6-B0F0-4E48-B87C-5376FC98A58D" width="450" height="194"></a><br><br>æ„‰å¿«ä½¿ç”¨OCå’ŒSwiftçš„æ··ç¼–å§</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="www.wangsen.website/posts/56109/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹æ£®">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹æ£®åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/posts/56109/" itemprop="url">
                  OCä¸­loadæ–¹æ³•å’Œinitializeæ–¹æ³•çš„åŒºåˆ«
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-05-10T18:53:03+08:00">
                2017-05-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OC/" itemprop="url" rel="index">
                    <span itemprop="name">OC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/posts/56109/" class="leancloud_visitors" data-flag-title="OCä¸­loadæ–¹æ³•å’Œinitializeæ–¹æ³•çš„åŒºåˆ«">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>OCä¸­æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„ç±»æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯<code>load</code>å’Œ<code>initialize</code>ã€‚æœ¬æ–‡æ€»ç»“ä¸€ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«äºè”ç³»ã€ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚Demoå¯ä»¥åœ¨æˆ‘çš„Githubä¸Šæ‰¾åˆ°â€”â€”<a href="https://github.com/ws1227/MySampleCoe" target="_blank">loadå’Œinitialize</a>ï¼Œå¦‚æœè§‰å¾—æœ‰å¸®åŠ©è¿˜æœ›ç‚¹ä¸ªstarä»¥ç¤ºæ”¯æŒï¼Œæ€»ç»“åœ¨æ–‡ç« æœ«å°¾ã€‚</p><br><h1>load</h1><br><p>é¡¾åæ€ä¹‰ï¼Œ<code>load</code>æ–¹æ³•åœ¨è¿™ä¸ªæ–‡ä»¶è¢«ç¨‹åºè£…è½½æ—¶è°ƒç”¨ã€‚åªè¦æ˜¯åœ¨Compile Sourcesä¸­å‡ºç°çš„æ–‡ä»¶æ€»æ˜¯ä¼šè¢«è£…è½½ï¼Œè¿™ä¸è¿™ä¸ªç±»æ˜¯å¦è¢«ç”¨åˆ°æ— å…³ï¼Œå› æ­¤<code>load</code>æ–¹æ³•æ€»æ˜¯åœ¨<code>main</code>å‡½æ•°ä¹‹å‰è°ƒç”¨ã€‚</p><br><h3>è°ƒç”¨è§„åˆ™</h3><br><p>å¦‚æœä¸€ä¸ªç±»å®ç°äº†<code>load</code>æ–¹æ³•ï¼Œåœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•å‰ä¼šé¦–å…ˆè°ƒç”¨çˆ¶ç±»çš„<code>load</code>æ–¹æ³•ã€‚è€Œä¸”è¿™ä¸ªè¿‡ç¨‹æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å®ç°ï¼š<br><br><pre><code class="objc">// In Parent.m<br>+ (void)load {<br>    NSLog(@â€Load Class Parentâ€);<br>}<br><br>// In Child.mï¼Œç»§æ‰¿è‡ªParent<br>+ (void)load {<br>    NSLog(@â€Load Class Childâ€);<br>}<br><br>// In Child+load.mï¼ŒChildç±»çš„åˆ†ç±»<br>+ (void)load {<br>    NSLog(@â€Load Class Child+loadâ€);<br>}<br><br>// è¿è¡Œç»“æœï¼š<br>/<em><br>    2016-02-01 21:28:14.379 load[11789:1435378] Load Class Parent<br>    2016-02-01 21:28:14.380 load[11789:1435378] Load Class Child<br>    2016-02-01 22:28:14.381 load[11789:1435378] Load Class Child+load
</em>/</code></pre><br><br><p>å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç°<code>load</code>æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¸ä¼šè°ƒç”¨å®ƒçˆ¶ç±»çš„<code>load</code>æ–¹æ³•ï¼Œè¿™ä¸€ç‚¹ä¸æ­£å¸¸çš„ç±»ç»§æ‰¿å’Œæ–¹æ³•è°ƒç”¨ä¸ä¸€æ ·ï¼Œéœ€è¦é¢å¤–æ³¨æ„ä¸€ä¸‹ã€‚</p><br><h3>æ‰§è¡Œé¡ºåº</h3><br><p><code>load</code>æ–¹æ³•è°ƒç”¨æ—¶ï¼Œç³»ç»Ÿå¤„äºè„†å¼±çŠ¶æ€ï¼Œå¦‚æœè°ƒç”¨åˆ«çš„ç±»çš„æ–¹æ³•ï¼Œä¸”è¯¥æ–¹æ³•ä¾èµ–äºé‚£ä¸ªç±»çš„<code>load</code>æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–è®¾ç½®ï¼Œé‚£ä¹ˆå¿…é¡»ç¡®ä¿é‚£ä¸ªç±»çš„<code>load</code>æ–¹æ³•å·²ç»è°ƒç”¨äº†ï¼Œæ¯”å¦‚demoä¸­çš„è¿™æ®µä»£ç ï¼Œæ‰“å°å‡ºçš„å­—ç¬¦ä¸²å°±ä¸º<code>null</code>ï¼š</p>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// In Child.m</div><div class="line">+ (void)load &#123;</div><div class="line">    NSLog(@&quot;Load Class Child&quot;);</div><div class="line"></div><div class="line">    Other *other = [Other new];</div><div class="line">    [other originalFunc];</div><div class="line">   </div><div class="line">    // å¦‚æœä¸å…ˆè°ƒç”¨otherçš„loadï¼Œä¸‹é¢è¿™è¡Œä»£ç å°±æ— æ•ˆï¼Œæ‰“å°å‡ºnull</div><div class="line">    [Other printName];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>load</code>æ–¹æ³•çš„è°ƒç”¨é¡ºåºå…¶å®æœ‰è¿¹å¯å¾ªï¼Œæˆ‘ä»¬çœ‹åˆ°demoçš„é¡¹ç›®è®¾ç½®å¦‚ä¸‹ï¼š</p><br><div class="image-package"><br><img src="http://upload-images.jianshu.io/upload_images/1171077-417e6180d36303a6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/1171077-417e6180d36303a6.png?imageMogr2/auto-orient/strip%7CimageView2/2"><br><div class="image-caption">æ‰§è¡Œé¡ºåº</div><br></div><br><p>åœ¨Compile Sourcesä¸­ï¼Œæ–‡ä»¶çš„æ’æ”¾é¡ºåºå°±æ˜¯å…¶è£…è½½é¡ºåºï¼Œè‡ªç„¶ä¹Ÿå°±æ˜¯<code>load</code>æ–¹æ³•è°ƒç”¨çš„é¡ºåºã€‚è¿™ä¸€ç‚¹ä¹Ÿè¯æ˜äº†<code>load</code>æ–¹æ³•ä¸­ä¼šè‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œå› ä¸ºåœ¨demoçš„è¾“å‡ºç»“æœä¸­ï¼Œ<code>Parent</code>çš„<code>load</code>æ–¹æ³•å…ˆäº<code>Child</code>è°ƒç”¨ï¼Œè€Œå®ƒçš„è£…è½½é¡ºåºå…¶å®åœ¨<code>Child</code>ä¹‹åã€‚</p><br><p>è™½ç„¶åœ¨è¿™ç§ç®€å•æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥è¾¨åˆ«å‡ºå„ä¸ªç±»çš„<code>load</code>æ–¹æ³•è°ƒç”¨çš„é¡ºåºï¼Œä½†<strong>æ°¸è¿œä¸è¦</strong>ä¾èµ–è¿™ä¸ªé¡ºåºå®Œæˆä½ çš„ä»£ç é€»è¾‘ã€‚ä¸€æ–¹é¢ï¼Œè¿™åœ¨åæœŸçš„å¼€å‘ä¸­æå®¹æ˜“å¯¼è‡´é”™è¯¯ï¼Œå¦ä¸€æ–¹é¢ï¼Œä½ å®é™…ä¸Šå¹¶ä¸éœ€è¦è¿™ä¹ˆåšã€‚</p><br><h3>ä½¿ç”¨åœºæ™¯</h3><br><p>ç”±äºè°ƒç”¨<code>load</code>æ–¹æ³•æ—¶çš„ç¯å¢ƒå¾ˆä¸å®‰å…¨ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡å‡å°‘<code>load</code>æ–¹æ³•çš„é€»è¾‘ã€‚å¦ä¸€ä¸ªåŸå› æ˜¯<code>load</code>æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒå†…éƒ¨ä½¿ç”¨äº†é”ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥é¿å…çº¿ç¨‹é˜»å¡åœ¨<code>load</code>æ–¹æ³•ä¸­ã€‚</p><br><p>ä¸€ä¸ªå¸¸è§çš„ä½¿ç”¨åœºæ™¯æ˜¯åœ¨<code>load</code>æ–¹æ³•ä¸­å®ç°Method Swizzleï¼š</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// In Other.m</div><div class="line">+ (void)load &#123;</div><div class="line">    Method originalFunc = class_getInstanceMethod([self class], @selector(originalFunc));</div><div class="line">    Method swizzledFunc = class_getInstanceMethod([self class], @selector(swizzledFunc));</div><div class="line"></div><div class="line">    method_exchangeImplementations(originalFunc, swizzledFunc);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/posts/56109/#more" rel="contents">
              é˜…è¯»å…¨æ–‡ &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="www.wangsen.website/posts/25752/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ç‹æ£®">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç‹æ£®åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/posts/25752/" itemprop="url">
                  swiftæŠ¥é”™UICollectionView must be initialized with a non-nil layout parameter
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-05-05T16:36:47+08:00">
                2017-05-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/posts/25752/" class="leancloud_visitors" data-flag-title="swiftæŠ¥é”™UICollectionView must be initialized with a non-nil layout parameter">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä»Šå¤©å­¦ä¹ swiftçš„UICollectionViewæ—¶å€™é¡¹ç›®è¿è¡Œå°±æŠ¥é”™ï¼Œæ§åˆ¶å°æ˜¾ç¤º<br>â€œUICollectionView must be initialized with a non-nil layout parameterâ€ï¼Œæ„æ€å¾ˆæ˜æ˜¾å°±æ˜¯UICollectionViewåˆå§‹åŒ–æ—¶å€™æ²¡æœ‰ç»™ä¸ªæœ‰æ•ˆçš„layoutï¼Œå°±æ˜¯è¯´UICollectionViewFlowLayoutæ²¡æœ‰åˆå§‹åŒ–ï¼Œæˆ‘å°±çº³é—·äº†æ˜æ˜æ˜¯åˆå§‹åŒ–äº†å•Š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">å…¨å±€å˜é‡</div><div class="line"> private  var layout = UICollectionViewFlowLayout()</div><div class="line"> private  var collectionView :UICollectionView()</div></pre></td></tr></table></figure>
<p>ç„¶ååœ¨viewDidLoadé‡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">collectionView = UICollectionView(frame: self.view.bounds, collectionViewLayout: layout)</div></pre></td></tr></table></figure>
<p>çœ‹èµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œæ‰åˆå­¦swiftä¸çŸ¥é“</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private  var collectionView :UICollectionView()</div></pre></td></tr></table></figure>
<p>è¿™æ ·å†™å·²ç»æ˜¯åˆå§‹åŒ–äº†ï¼Œæ‰€ä»¥å°±æŠ¥é”™äº†ï¼Œåº”è¯¥åœ¨å£°æ˜å˜é‡çš„æ—¶å€™æ”¹ä¸ºå¦‚ä¸‹å†™æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private    var collectionView :UICollectionView!</div></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å°±åªæ˜¯å£°æ˜å˜é‡äº†å†åœ¨viewDidLoadé‡Œåˆå§‹åŒ–ä½¿ç”¨å°±æ²¡é—®é¢˜äº†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> layout = UICollectionViewFlowLayout()</div><div class="line">collectionView = UICollectionView(frame: self.view.bounds, collectionViewLayout: layout)</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="ç‹æ£®" />
          <p class="site-author-name" itemprop="name">ç‹æ£®</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ws1227" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/qq1176183741/home?wvr=5" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ç‹æ£®</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  
    
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "622740468d034020b2e33dab287e9505",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
  







  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("6CYvU02F3S8nOsPFJrrHiKGR-gzGzoHsz", "LWEI7xU093wgomlWkvtxF42I");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


  

</body>
</html>
